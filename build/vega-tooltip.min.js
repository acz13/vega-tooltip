!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vegaTooltip=e()}}(function(){var e;return function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n||e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(){}function n(e,n){var r=new t;if(e instanceof t)e.each(function(e,t){r.set(t,e)});else if(Array.isArray(e)){var i,a=-1,o=e.length;if(null==n)for(;++a<o;)r.set(a,e[a]);else for(;++a<o;)r.set(n(i=e[a],a,e),i)}else if(e)for(var s in e)r.set(s,e[s]);return r}function r(){return{}}function i(e,t,n){e[t]=n}function a(){return n()}function o(e,t,n){e.set(t,n)}function s(){}function u(e,t){var n=new s;if(e instanceof s)e.each(function(e){n.add(e)});else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}t.prototype=n.prototype={constructor:t,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var l=function(){function e(t,r,i,a){if(r>=c.length)return null!=u?u(t):null!=s?t.sort(s):t;for(var o,l,f,d=-1,p=t.length,m=c[r++],h=n(),g=i();++d<p;)(f=h.get(o=m(l=t[d])+""))?f.push(l):h.set(o,[l]);return h.each(function(t,n){a(g,n,e(t,r,i,a))}),g}function t(e,n){if(++n>c.length)return e;var r,i=f[n-1];return null!=u&&n>=c.length?r=e.entries():(r=[],e.each(function(e,i){r.push({key:i,values:t(e,n)})})),null!=i?r.sort(function(e,t){return i(e.key,t.key)}):r}var s,u,l,c=[],f=[];return l={object:function(t){return e(t,0,r,i)},map:function(t){return e(t,0,a,o)},entries:function(n){return t(e(n,0,a,o),0)},key:function(e){return c.push(e),l},sortKeys:function(e){return f[c.length-1]=e,l},sortValues:function(e){return s=e,l},rollup:function(e){return u=e,l}}},c=n.prototype;s.prototype=u.prototype={constructor:s,has:c.has,add:function(e){return e+="",this["$"+e]=e,this},remove:c.remove,clear:c.clear,values:c.keys,size:c.size,empty:c.empty,each:c.each};var f=function(e){var t=[];for(var n in e)t.push(n);return t},d=function(e){var t=[];for(var n in e)t.push(e[n]);return t},p=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t};e.nest=l,e.set=u,e.map=n,e.keys=f,e.values=d,e.entries=p,Object.defineProperty(e,"__esModule",{value:!0})})},{}],2:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(e){return new n(e)}function n(e){if(!(t=p.exec(e)))throw new Error("invalid format: "+e);var t,n=t[1]||" ",r=t[2]||">",i=t[3]||"-",a=t[4]||"",o=!!t[5],s=t[6]&&+t[6],u=!!t[7],l=t[8]&&+t[8].slice(1),c=t[9]||"";"n"===c?(u=!0,c="g"):d[c]||(c=""),(o||"0"===n&&"="===r)&&(o=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=a,this.zero=o,this.width=s,this.comma=u,this.precision=l,this.type=c}function r(t){return m=v(t),e.format=m.format,e.formatPrefix=m.formatPrefix,m}var i,a=function(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]},o=function(e){return e=a(Math.abs(e)),e?e[1]:NaN},s=function(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}},u=function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}},l=function(e,t){e=e.toPrecision(t);e:for(var n,r=e.length,i=1,a=-1;i<r;++i)switch(e[i]){case".":a=n=i;break;case"0":0===a&&(a=i),n=i;break;case"e":break e;default:a>0&&(a=0)}return a>0?e.slice(0,a)+e.slice(n+1):e},c=function(e,t){var n=a(e,t);if(!n)return e+"";var r=n[0],o=n[1],s=o-(i=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,u=r.length;return s===u?r:s>u?r+new Array(s-u+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+a(e,Math.max(0,t+s-1))[0]},f=function(e,t){var n=a(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},d={"":l,"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return f(100*e,t)},r:f,s:c,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},p=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;t.prototype=n.prototype,n.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var m,h=function(e){return e},g=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"],v=function(e){function n(e){function n(e){var t,n,u,l=_,d=S;if("c"===b)d=E(e)+d,e="";else{e=+e;var p=e<0;if(e=E(Math.abs(e),y),p&&0==+e&&(p=!1),l=(p?"("===s?s:"-":"-"===s||"("===s?"":s)+l,d=d+("s"===b?g[8+i/3]:"")+(p&&"("===s?")":""),x)for(t=-1,n=e.length;++t<n;)if(48>(u=e.charCodeAt(t))||u>57){d=(46===u?c+e.slice(t+1):e.slice(t))+d,e=e.slice(0,t);break}}v&&!m&&(e=a(e,1/0));var O=l.length+e.length+d.length,T=O<h?new Array(h-O+1).join(r):"";switch(v&&m&&(e=a(T+e,T.length?h-d.length:1/0),T=""),o){case"<":e=l+e+d+T;break;case"=":e=l+T+e+d;break;case"^":e=T.slice(0,O=T.length>>1)+l+e+d+T.slice(O);break;default:e=T+l+e+d}return f(e)}e=t(e);var r=e.fill,o=e.align,s=e.sign,u=e.symbol,m=e.zero,h=e.width,v=e.comma,y=e.precision,b=e.type,_="$"===u?l[0]:"#"===u&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",S="$"===u?l[1]:/[%p]/.test(b)?p:"",E=d[b],x=!b||/[defgprs%]/.test(b);return y=null==y?b?6:12:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),n.toString=function(){return e+""},n}function r(e,r){var i=n((e=t(e),e.type="f",e)),a=3*Math.max(-8,Math.min(8,Math.floor(o(r)/3))),s=Math.pow(10,-a),u=g[8+a/3];return function(e){return i(s*e)+u}}var a=e.grouping&&e.thousands?s(e.grouping,e.thousands):h,l=e.currency,c=e.decimal,f=e.numerals?u(e.numerals):h,p=e.percent||"%";return{format:n,formatPrefix:r}};r({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var y=function(e){return Math.max(0,-o(Math.abs(e)))},b=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(o(t)/3)))-o(Math.abs(e)))},_=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,o(t)-o(e))+1};e.formatDefaultLocale=r,e.formatLocale=v,e.formatSpecifier=t,e.precisionFixed=y,e.precisionPrefix=b,e.precisionRound=_,Object.defineProperty(e,"__esModule",{value:!0})})},{}],3:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===J&&t.documentElement.namespaceURI===J?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function r(){return new i}function i(){this._="@"+(++ne).toString(36)}function a(e,t,n){return e=o(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function o(t,n,r){return function(i){var a=e.event;e.event=i;try{t.call(this,this.__data__,n,r)}finally{e.event=a}}}function s(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function u(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function l(e,t,n){var r=se.hasOwnProperty(e.type)?a:o;return function(i,a,o){var s,u=this.__on,l=r(t,a,o);if(u)for(var c=0,f=u.length;c<f;++c)if((s=u[c]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=t);this.addEventListener(e.type,l,n),s={type:e.type,name:e.name,value:t,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function c(t,n,r,i){var a=e.event;t.sourceEvent=e.event,e.event=t;try{return n.apply(r,i)}finally{e.event=a}}function f(){}function d(){return[]}function p(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function m(e,t,n,r,i,a){for(var o,s=0,u=t.length,l=a.length;s<l;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new p(e,a[s]);for(;s<u;++s)(o=t[s])&&(i[s]=o)}function h(e,t,n,r,i,a,o){var s,u,l,c={},f=t.length,d=a.length,m=new Array(f);for(s=0;s<f;++s)(u=t[s])&&(m[s]=l=_e+o.call(u,u.__data__,s,t),l in c?i[s]=u:c[l]=u);for(s=0;s<d;++s)l=_e+o.call(e,a[s],s,a),(u=c[l])?(r[s]=u,u.__data__=a[s],c[l]=null):n[s]=new p(e,a[s]);for(s=0;s<f;++s)(u=t[s])&&c[m[s]]===u&&(i[s]=u)}function g(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){return function(){this.removeAttribute(e)}}function y(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function _(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function S(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function E(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function x(e){return function(){this.style.removeProperty(e)}}function O(e,t,n){return function(){this.style.setProperty(e,t,n)}}function T(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function N(e){return function(){delete this[e]}}function w(e,t){return function(){this[e]=t}}function A(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function D(e){return e.trim().split(/^|\s+/)}function M(e){return e.classList||new k(e)}function k(e){this._node=e,this._names=D(e.getAttribute("class")||"")}function C(e,t){for(var n=M(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function P(e,t){for(var n=M(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function R(e){return function(){C(this,e)}}function I(e){return function(){P(this,e)}}function L(e,t){return function(){(t.apply(this,arguments)?C:P)(this,e)}}function U(){this.textContent=""}function F(e){return function(){this.textContent=e}}function j(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function H(){this.innerHTML=""}function z(e){return function(){this.innerHTML=e}}function Y(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function X(){this.nextSibling&&this.parentNode.appendChild(this)}function W(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function q(){return null}function B(){var e=this.parentNode;e&&e.removeChild(this)}function G(e,t,n){var r=Pe(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function V(e,t){return function(){return G(this,e,t)}}function Q(e,t){return function(){return G(this,e,t.apply(this,arguments))}}function Z(e,t){this._groups=e,this._parents=t}function K(){return new Z([[document.documentElement]],Be)}var J="http://www.w3.org/1999/xhtml",$={svg:"http://www.w3.org/2000/svg",xhtml:J,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ee=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),$.hasOwnProperty(t)?{space:$[t],local:e}:e},te=function(e){var r=ee(e);return(r.local?n:t)(r)},ne=0;i.prototype=r.prototype={constructor:i,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var re=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var ie=document.documentElement;if(!ie.matches){var ae=ie.webkitMatchesSelector||ie.msMatchesSelector||ie.mozMatchesSelector||ie.oMatchesSelector;re=function(e){return function(){return ae.call(this,e)}}}}var oe=re,se={};if(e.event=null,"undefined"!=typeof document){"onmouseenter"in document.documentElement||(se={mouseenter:"mouseover",mouseleave:"mouseout"})}var ue=function(e,t,n){var r,i,a=s(e+""),o=a.length;{if(!(arguments.length<2)){for(c=t?l:u,null==n&&(n=!1),r=0;r<o;++r)this.each(c(a[r],t,n));return this}var c=this.node().__on;if(c)for(var f,d=0,p=c.length;d<p;++d)for(r=0,f=c[d];r<o;++r)if((i=a[r]).type===f.type&&i.name===f.name)return f.value}},le=function(){for(var t,n=e.event;t=n.sourceEvent;)n=t;return n},ce=function(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]},fe=function(e){var t=le();return t.changedTouches&&(t=t.changedTouches[0]),ce(e,t)},de=function(e){return null==e?f:function(){return this.querySelector(e)}},pe=function(e){"function"!=typeof e&&(e=de(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],u=s.length,l=r[i]=new Array(u),c=0;c<u;++c)(a=s[c])&&(o=e.call(a,a.__data__,c,s))&&("__data__"in a&&(o.__data__=a.__data__),l[c]=o);return new Z(r,this._parents)},me=function(e){return null==e?d:function(){return this.querySelectorAll(e)}},he=function(e){"function"!=typeof e&&(e=me(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,l=0;l<u;++l)(o=s[l])&&(r.push(e.call(o,o.__data__,l,s)),i.push(o));return new Z(r,i)},ge=function(e){"function"!=typeof e&&(e=oe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new Z(r,this._parents)},ve=function(e){return new Array(e.length)},ye=function(){return new Z(this._enter||this._groups.map(ve),this._parents)};p.prototype={constructor:p,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var be=function(e){return function(){return e}},_e="$",Se=function(e,t){if(!e)return p=new Array(this.size()),l=-1,this.each(function(e){p[++l]=e}),p;var n=t?h:m,r=this._parents,i=this._groups;"function"!=typeof e&&(e=be(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=r[l],f=i[l],d=f.length,p=e.call(c,c&&c.__data__,l,r),g=p.length,v=s[l]=new Array(g),y=o[l]=new Array(g);n(c,f,v,y,u[l]=new Array(d),p,t);for(var b,_,S=0,E=0;S<g;++S)if(b=v[S]){for(S>=E&&(E=S+1);!(_=y[E])&&++E<g;);b._next=_||null}}return o=new Z(o,r),o._enter=s,o._exit=u,o},Ee=function(){return new Z(this._exit||this._groups.map(ve),this._parents)},xe=function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,l=t[s],c=n[s],f=l.length,d=o[s]=new Array(f),p=0;p<f;++p)(u=l[p]||c[p])&&(d[p]=u);for(;s<r;++s)o[s]=t[s];return new Z(o,this._parents)},Oe=function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},Te=function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=g);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,l=i[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(t)}return new Z(i,this._parents).order()},Ne=function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},we=function(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},Ae=function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},De=function(){var e=0;return this.each(function(){++e}),e},Me=function(){return!this.node()},ke=function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},Ce=function(e,t){var n=ee(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?y:v:"function"==typeof t?n.local?E:S:n.local?_:b)(n,t))},Pe=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView},Re=function(e,t,n){var r;return arguments.length>1?this.each((null==t?x:"function"==typeof t?T:O)(e,t,null==n?"":n)):Pe(r=this.node()).getComputedStyle(r,null).getPropertyValue(e)},Ie=function(e,t){return arguments.length>1?this.each((null==t?N:"function"==typeof t?A:w)(e,t)):this.node()[e]};k.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Le=function(e,t){var n=D(e+"");if(arguments.length<2){for(var r=M(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?L:t?R:I)(n,t))},Ue=function(e){return arguments.length?this.each(null==e?U:("function"==typeof e?j:F)(e)):this.node().textContent},Fe=function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?Y:z)(e)):this.node().innerHTML},je=function(){return this.each(X)},He=function(){return this.each(W)},ze=function(e){var t="function"==typeof e?e:te(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},Ye=function(e,t){var n="function"==typeof e?e:te(e),r=null==t?q:"function"==typeof t?t:de(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},Xe=function(){return this.each(B)},We=function(e){return arguments.length?this.property("__data__",e):this.node().__data__},qe=function(e,t){return this.each(("function"==typeof t?Q:V)(e,t))},Be=[null];Z.prototype=K.prototype={constructor:Z,select:pe,selectAll:he,filter:ge,data:Se,enter:ye,exit:Ee,merge:xe,order:Oe,sort:Te,call:Ne,nodes:we,node:Ae,size:De,empty:Me,each:ke,attr:Ce,style:Re,property:Ie,classed:Le,text:Ue,html:Fe,raise:je,lower:He,append:ze,insert:Ye,remove:Xe,datum:We,on:ue,dispatch:qe};var Ge=function(e){return"string"==typeof e?new Z([[document.querySelector(e)]],[document.documentElement]):new Z([[e]],Be)},Ve=function(e){return"string"==typeof e?new Z([document.querySelectorAll(e)],[document.documentElement]):new Z([null==e?[]:e],Be)},Qe=function(e,t,n){arguments.length<3&&(n=t,t=le().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return ce(e,r);return null},Ze=function(e,t){null==t&&(t=le().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=ce(e,t[n]);return i};e.creator=te,e.local=r,e.matcher=oe,e.mouse=fe,e.namespace=ee,e.namespaces=$,e.select=Ge,e.selectAll=Ve,e.selection=K,e.selector=de,e.selectorAll=me,e.touch=Qe,e.touches=Ze,e.window=Pe,e.customEvent=c,Object.defineProperty(e,"__esModule",{value:!0})})},{}],4:[function(t,n,r){!function(i,a){"object"==typeof r&&void 0!==n?a(r,t("d3-time")):"function"==typeof e&&e.amd?e(["exports","d3-time"],a):a(i.d3=i.d3||{},i.d3)}(this,function(e,t){"use strict";function n(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function r(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function i(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function a(e){function t(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=re[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function a(e,t){return function(n){var a=i(1900);if(o(a,e,n+="",0)!=n.length)return null;if("p"in a&&(a.H=a.H%12+12*a.p),"W"in a||"U"in a){"w"in a||(a.w="W"in a?1:0);var s="Z"in a?r(i(a.y)).getUTCDay():t(i(a.y)).getDay();a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(s+5)%7:a.w+7*a.U-(s+6)%7}return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,r(a)):t(a)}}function o(e,t,n,r){for(var i,a,o=0,s=t.length,u=n.length;o<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=Ue[i in re?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function s(e,t,n){var r=Te.exec(t.slice(n));return r?(e.p=Ne[r[0].toLowerCase()],n+r[0].length):-1}function $(e,t,n){var r=De.exec(t.slice(n));return r?(e.w=Me[r[0].toLowerCase()],n+r[0].length):-1}function ee(e,t,n){var r=we.exec(t.slice(n));return r?(e.w=Ae[r[0].toLowerCase()],n+r[0].length):-1}function te(e,t,n){var r=Pe.exec(t.slice(n));return r?(e.m=Re[r[0].toLowerCase()],n+r[0].length):-1}function ne(e,t,n){var r=ke.exec(t.slice(n));return r?(e.m=Ce[r[0].toLowerCase()],n+r[0].length):-1}function ie(e,t,n){return o(e,ve,t,n)}function ae(e,t,n){return o(e,ye,t,n)}function oe(e,t,n){return o(e,be,t,n)}function se(e){return Ee[e.getDay()]}function ue(e){return Se[e.getDay()]}function le(e){return Oe[e.getMonth()]}function ce(e){return xe[e.getMonth()]}function fe(e){return _e[+(e.getHours()>=12)]}function de(e){return Ee[e.getUTCDay()]}function pe(e){return Se[e.getUTCDay()]}function me(e){return Oe[e.getUTCMonth()]}function he(e){return xe[e.getUTCMonth()]}function ge(e){return _e[+(e.getUTCHours()>=12)]}var ve=e.dateTime,ye=e.date,be=e.time,_e=e.periods,Se=e.days,Ee=e.shortDays,xe=e.months,Oe=e.shortMonths,Te=u(_e),Ne=l(_e),we=u(Se),Ae=l(Se),De=u(Ee),Me=l(Ee),ke=u(xe),Ce=l(xe),Pe=u(Oe),Re=l(Oe),Ie={a:se,A:ue,b:le,B:ce,c:null,d:O,e:O,H:T,I:N,j:w,L:A,m:D,M:M,p:fe,S:k,U:C,w:P,W:R,x:null,X:null,y:I,Y:L,Z:U,"%":J},Le={a:de,A:pe,b:me,B:he,c:null,d:F,e:F,H:j,I:H,j:z,L:Y,m:X,M:W,p:ge,S:q,U:B,w:G,W:V,x:null,X:null,y:Q,Y:Z,Z:K,"%":J},Ue={a:$,A:ee,b:te,B:ne,c:ie,d:v,e:v,H:b,I:b,j:y,L:E,m:g,M:_,p:s,S:S,U:f,w:c,W:d,x:ae,X:oe,y:m,Y:p,Z:h,"%":x};return Ie.x=t(ye,Ie),Ie.X=t(be,Ie),Ie.c=t(ve,Ie),Le.x=t(ye,Le),Le.X=t(be,Le),Le.c=t(ve,Le),{format:function(e){var n=t(e+="",Ie);return n.toString=function(){return e},n},parse:function(e){var t=a(e+="",n);return t.toString=function(){return e},t},utcFormat:function(e){var n=t(e+="",Le);return n.toString=function(){return e},n},utcParse:function(e){var t=a(e,r);return t.toString=function(){return e},t}}}function o(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function s(e){return e.replace(oe,"\\$&")}function u(e){return new RegExp("^(?:"+e.map(s).join("|")+")","i")}function l(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function c(e,t,n){var r=ie.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function f(e,t,n){var r=ie.exec(t.slice(n));return r?(e.U=+r[0],n+r[0].length):-1}function d(e,t,n){var r=ie.exec(t.slice(n));return r?(e.W=+r[0],n+r[0].length):-1}function p(e,t,n){var r=ie.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function m(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function h(e,t,n){var r=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function g(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function v(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function y(e,t,n){var r=ie.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function b(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function _(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function S(e,t,n){var r=ie.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function E(e,t,n){var r=ie.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function x(e,t,n){var r=ae.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function O(e,t){return o(e.getDate(),t,2)}function T(e,t){return o(e.getHours(),t,2)}function N(e,t){return o(e.getHours()%12||12,t,2)}function w(e,n){return o(1+t.timeDay.count(t.timeYear(e),e),n,3)}function A(e,t){return o(e.getMilliseconds(),t,3)}function D(e,t){return o(e.getMonth()+1,t,2)}function M(e,t){return o(e.getMinutes(),t,2)}function k(e,t){return o(e.getSeconds(),t,2)}function C(e,n){return o(t.timeSunday.count(t.timeYear(e),e),n,2)}function P(e){return e.getDay()}function R(e,n){return o(t.timeMonday.count(t.timeYear(e),e),n,2)}function I(e,t){return o(e.getFullYear()%100,t,2)}function L(e,t){return o(e.getFullYear()%1e4,t,4)}function U(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+o(t/60|0,"0",2)+o(t%60,"0",2)}function F(e,t){return o(e.getUTCDate(),t,2)}function j(e,t){return o(e.getUTCHours(),t,2)}function H(e,t){return o(e.getUTCHours()%12||12,t,2)}function z(e,n){return o(1+t.utcDay.count(t.utcYear(e),e),n,3)}function Y(e,t){return o(e.getUTCMilliseconds(),t,3)}function X(e,t){return o(e.getUTCMonth()+1,t,2)}function W(e,t){return o(e.getUTCMinutes(),t,2)}function q(e,t){return o(e.getUTCSeconds(),t,2)}function B(e,n){return o(t.utcSunday.count(t.utcYear(e),e),n,2)}function G(e){return e.getUTCDay()}function V(e,n){return o(t.utcMonday.count(t.utcYear(e),e),n,2)}function Q(e,t){return o(e.getUTCFullYear()%100,t,2)}function Z(e,t){return o(e.getUTCFullYear()%1e4,t,4)}function K(){return"+0000"}function J(){return"%"}function $(t){return ne=a(t),e.timeFormat=ne.format,e.timeParse=ne.parse,e.utcFormat=ne.utcFormat,e.utcParse=ne.utcParse,ne}function ee(e){return e.toISOString()}function te(e){var t=new Date(e);return isNaN(t)?null:t}var ne,re={"-":"",_:" ",0:"0"},ie=/^\s*\d+/,ae=/^%/,oe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;$({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var se=Date.prototype.toISOString?ee:e.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ"),ue=+new Date("2000-01-01T00:00:00.000Z")?te:e.utcParse("%Y-%m-%dT%H:%M:%S.%LZ");e.timeFormatDefaultLocale=$,e.timeFormatLocale=a,e.isoFormat=se,e.isoParse=ue,Object.defineProperty(e,"__esModule",{value:!0})})},{"d3-time":5}],5:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(e,n,r,o){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.ceil=function(t){return e(t=new Date(t-1)),n(t,1),e(t),t},s.round=function(e){var t=s(e),n=s.ceil(e);return e-t<n-e?t:n},s.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,r,i){var a=[];if(t=s.ceil(t),i=null==i?1:Math.floor(i),!(t<r&&i>0))return a;do{a.push(new Date(+t))}while(n(t,i),e(t),t<r);return a},s.filter=function(r){return t(function(t){if(t>=t)for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){if(e>=e)for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(s.count=function(t,n){return i.setTime(+t),a.setTime(+n),e(i),e(a),Math.floor(r(i,a))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(o?function(t){return o(t)%e==0}:function(t){return s.count(0,t)%e==0}):s:null}),s}function n(e){return t(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*u)/l})}function r(e){return t(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/l})}var i=new Date,a=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):o:null};var s=o.range,u=6e4,l=6048e5,c=t(function(e){e.setTime(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),f=c.range,d=t(function(e){e.setTime(Math.floor(e/u)*u)},function(e,t){e.setTime(+e+t*u)},function(e,t){return(t-e)/u},function(e){return e.getMinutes()}),p=d.range,m=t(function(e){var t=e.getTimezoneOffset()*u%36e5;t<0&&(t+=36e5),e.setTime(36e5*Math.floor((+e-t)/36e5)+t)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),h=m.range,g=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*u)/864e5},function(e){return e.getDate()-1}),v=g.range,y=n(0),b=n(1),_=n(2),S=n(3),E=n(4),x=n(5),O=n(6),T=y.range,N=b.range,w=_.range,A=S.range,D=E.range,M=x.range,k=O.range,C=t(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),P=C.range,R=t(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});R.every=function(e){return isFinite(e=Math.floor(e))&&e>0?t(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};var I=R.range,L=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*u)},function(e,t){return(t-e)/u},function(e){return e.getUTCMinutes()}),U=L.range,F=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){
e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),j=F.range,H=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),z=H.range,Y=r(0),X=r(1),W=r(2),q=r(3),B=r(4),G=r(5),V=r(6),Q=Y.range,Z=X.range,K=W.range,J=q.range,$=B.range,ee=G.range,te=V.range,ne=t(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),re=ne.range,ie=t(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ie.every=function(e){return isFinite(e=Math.floor(e))&&e>0?t(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};var ae=ie.range;e.timeInterval=t,e.timeMillisecond=o,e.timeMilliseconds=s,e.utcMillisecond=o,e.utcMilliseconds=s,e.timeSecond=c,e.timeSeconds=f,e.utcSecond=c,e.utcSeconds=f,e.timeMinute=d,e.timeMinutes=p,e.timeHour=m,e.timeHours=h,e.timeDay=g,e.timeDays=v,e.timeWeek=y,e.timeWeeks=T,e.timeSunday=y,e.timeSundays=T,e.timeMonday=b,e.timeMondays=N,e.timeTuesday=_,e.timeTuesdays=w,e.timeWednesday=S,e.timeWednesdays=A,e.timeThursday=E,e.timeThursdays=D,e.timeFriday=x,e.timeFridays=M,e.timeSaturday=O,e.timeSaturdays=k,e.timeMonth=C,e.timeMonths=P,e.timeYear=R,e.timeYears=I,e.utcMinute=L,e.utcMinutes=U,e.utcHour=F,e.utcHours=j,e.utcDay=H,e.utcDays=z,e.utcWeek=Y,e.utcWeeks=Q,e.utcSunday=Y,e.utcSundays=Q,e.utcMonday=X,e.utcMondays=Z,e.utcTuesday=W,e.utcTuesdays=K,e.utcWednesday=q,e.utcWednesdays=J,e.utcThursday=B,e.utcThursdays=$,e.utcFriday=G,e.utcFridays=ee,e.utcSaturday=V,e.utcSaturdays=te,e.utcMonth=ne,e.utcMonths=re,e.utcYear=ie,e.utcYears=ae,Object.defineProperty(e,"__esModule",{value:!0})})},{}],6:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},u=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},a={key:r,value:t[r]};return e(i,a)}}}(t.cmp),l=[];return function e(t,c,f,d){var p=n?"\n"+new Array(d+1).join(n):"",m=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),void 0!==(f=s.call(t,c,f))){if("object"!=typeof f||null===f)return r.stringify(f);if(i(f)){for(var h=[],g=0;g<f.length;g++){var v=e(f,g,f[g],d+1)||r.stringify(null);h.push(p+n+v)}return"["+h.join(",")+p+"]"}if(-1!==l.indexOf(f)){if(o)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}l.push(f);for(var y=a(f).sort(u&&u(f)),h=[],g=0;g<y.length;g++){var c=y[g],b=e(f,c,f[c],d+1);if(b){var _=r.stringify(c)+m+b;h.push(p+n+_)}}return l.splice(l.indexOf(f),1),"{"+h.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:7}],7:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":8,"./lib/stringify":9}],8:[function(e,t,n){var r,i,a,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},u=function(e){throw{name:"SyntaxError",message:e,at:r,text:a}},l=function(e){return e&&e!==i&&u("Expected '"+e+"' instead of '"+i+"'"),i=a.charAt(r),r+=1,i},c=function(){var e,t="";for("-"===i&&(t="-",l("-"));i>="0"&&i<="9";)t+=i,l();if("."===i)for(t+=".";l()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,l(),"-"!==i&&"+"!==i||(t+=i,l());i>="0"&&i<="9";)t+=i,l();if(e=+t,isFinite(e))return e;u("Bad number")},f=function(){var e,t,n,r="";if('"'===i)for(;l();){if('"'===i)return l(),r;if("\\"===i)if(l(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(l(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof s[i])break;r+=s[i]}else r+=i}u("Bad string")},d=function(){for(;i&&i<=" ";)l()},p=function(){switch(i){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}u("Unexpected '"+i+"'")},m=function(){var e=[];if("["===i){if(l("["),d(),"]"===i)return l("]"),e;for(;i;){if(e.push(o()),d(),"]"===i)return l("]"),e;l(","),d()}}u("Bad array")},h=function(){var e,t={};if("{"===i){if(l("{"),d(),"}"===i)return l("}"),t;for(;i;){if(e=f(),d(),l(":"),Object.hasOwnProperty.call(t,e)&&u('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===i)return l("}"),t;l(","),d()}}u("Bad object")};o=function(){switch(d(),i){case"{":return h();case"[":return m();case'"':return f();case"-":return c();default:return i>="0"&&i<="9"?c():p()}},t.exports=function(e,t){var n;return a=e,r=0,i=" ",n=o(),d(),i&&u("Syntax error"),"function"==typeof t?function e(n,r){var i,a,o=n[r];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(a=e(o,i),void 0!==a?o[i]=a:delete o[i]);return t.call(n,r,o)}({"":n},""):n}},{}],9:[function(e,t,n){function r(e){return u.lastIndex=0,u.test(e)?'"'+e.replace(u,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,u,l,c,f,d=a,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,n=0;n<c;n+=1)f[n]=i(n,p)||"null";return l=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,l}if(s&&"object"==typeof s)for(c=s.length,n=0;n<c;n+=1)"string"==typeof(u=s[n])&&(l=i(u,p))&&f.push(r(u)+(a?": ":":")+l);else for(u in p)Object.prototype.hasOwnProperty.call(p,u)&&(l=i(u,p))&&f.push(r(u)+(a?": ":":")+l);return l=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,l}}var a,o,s,u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(a="",o="","number"==typeof n)for(r=0;r<n;r+=1)o+=" ";else"string"==typeof n&&(o=n);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],10:[function(t,n,r){(function(t){var r,i,a,o,s,u,l,c,f,d,p,m,h,g,v,y;!function(r){function i(e,t){return function(n,r){return e[n]=t?t(n,r):r}}var a="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){r(i(a,i(e)))}):r("object"==typeof n&&"object"==typeof n.exports?i(a,i(n.exports)):i(a))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};r=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},o=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},s=function(e,t){return function(n,r){t(n,r,e)}},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},c=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,a=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},f=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},d=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},m=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},h=function(e){return this instanceof h?(this.v=e,this):new h(e)},g=function(e,t,n){function r(e){c[e]&&(l[e]=function(t){return new Promise(function(n,r){f.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{a(c[e](t))}catch(e){u(f[0][3],e)}}function a(e){e.value instanceof h?Promise.resolve(e.value.v).then(o,s):u(f[0][2],e)}function o(e){i("next",e)}function s(e){i("throw",e)}function u(e,t){e(t),f.shift(),f.length&&i(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,c=n.apply(e,t||[]),f=[];return l={},r("next"),r("throw"),r("return"),l[Symbol.asyncIterator]=function(){return this},l},v=function(e){function t(t){e[t]&&(n[t]=function(n){return(r=!r)?{value:h(e[t](n)),done:"return"===t}:n})}var n,r;return n={},t("next"),t("throw"),t("return"),n[Symbol.iterator]=function(){return this},n},y=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof d?d(e):e[Symbol.iterator]()},e("__extends",r),e("__assign",i),e("__rest",a),e("__decorate",o),e("__param",s),e("__metadata",u),e("__awaiter",l),e("__generator",c),e("__exportStar",f),e("__values",d),e("__read",p),e("__spread",m),e("__await",h),e("__asyncGenerator",g),e("__asyncDelegator",v),e("__asyncValues",y)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return l.hasOwnProperty(e)}function n(e,t,n,r,i){for(var a,o=0,s=e.length;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function r(e){for(var t=[],r=0,i=e.length,a=0;a<i;)a=n(e,a,v,d+m,p+h),t.push(e.substring(r,a).trim()),r=++a;if(0===t.length)throw"Empty event selector: "+e;return t}function i(e){return"["===e[0]?a(e):o(e)}function a(e){var t,a,o=e.length,s=1;if((s=n(e,s,p,d,p))===o)throw"Empty between selector: "+e;if(t=r(e.substring(1,s)),2!==t.length)throw"Between selector must have two elements: "+e;if(e=e.slice(s+1).trim(),e[0]!==b)throw"Expected '>' after between selector: "+e;return t=t.map(i),a=i(e.slice(1).trim()),a.between?{between:t,stream:a}:(a.between=t,a)}function o(e){var r,i,a={source:u},o=[],l=[0,0],c=0,f=0,v=e.length,b=0;if(e[v-1]===h){if(!((b=e.lastIndexOf(m))>=0))throw"Unmatched right brace: "+e;try{l=s(e.substring(b+1,v-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,b).trim(),v=e.length,b=0}if(!v)throw e;if(e[0]===y&&(c=++b),r=n(e,b,g),r<v&&(o.push(e.substring(f,r).trim()),f=b=++r),(b=n(e,b,d))===v)o.push(e.substring(f,v).trim());else if(o.push(e.substring(f,b).trim()),i=[],(f=++b)===v)throw"Unmatched left bracket: "+e;for(;b<v;){if((b=n(e,b,p))===v)throw"Unmatched left bracket: "+e;if(i.push(e.substring(f,b).trim()),b<v-1&&e[++b]!==d)throw"Expected left bracket: "+e;f=++b}if(!(v=o.length)||_.test(o[v-1]))throw"Invalid event selector: "+e;return v>1?(a.type=o[1],c?a.markname=o[0].slice(1):t(o[0])?a.marktype=o[0]:a.source=o[0]):a.type=o[0],"!"===a.type.slice(-1)&&(a.consume=!0,a.type=a.type.slice(0,-1)),null!=i&&(a.filter=i),l[0]&&(a.throttle=l[0]),l[1]&&(a.debounce=l[1]),a}function s(e){var t=e.split(v);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!==n)throw e;return n})}var u,l,c=function(e,t,n){return u=t||f,l=n||S,r(e.trim()).map(i)},f="view",d="[",p="]",m="{",h="}",g=":",v=",",y="@",b=">",_=/[\[\]\{\}]/,S={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=c,Object.defineProperty(e,"__esModule",{value:!0})})},{}],12:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-beta.2",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/vl.js",types:"build/src/vl.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{tsc:"rm -rf build/*/** && tsc",prebuild:"mkdir -p build/site build/examples/images build/test-gallery",build:"npm run tsc && cp package.json build && browserify src/vl.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"uglifyjs build/vega-lite.js -cm --in-source-map build/vega-lite.js.map --source-map build/vega-lite.min.js.map > build/vega-lite.min.js && npm run schema","build:examples":"./scripts/build-examples.sh && rm -rf examples/specs/normalized/* && scripts/build-normalized-examples","build:images":"npm run data && scripts/generate-images.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"npm run link && browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts|vg.json)' -delete & rm -rf data",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"typescript-json-schema --required true --noExtraProps true src/spec.ts TopLevelExtendedSpec > build/vega-lite-schema.json && rm -f _data/vega-lite-schema.json && npm run replaceschema && cp build/vega-lite-schema.json _data/",replaceschema:"sed -i -e 's/GenericLayerSpec<.*..\\./LayerSpec/g' build/vega-lite-schema.json && sed -i -e 's/GenericRepeatSpec<.*..\\./RepeatSpec/g' build/vega-lite-schema.json && sed -i -e 's/GenericUnitSpec<Encoding<.*..\\./UnitSpec/g' build/vega-lite-schema.json && sed -i -e 's/GenericUnitSpec<EncodingWithFacet<.*..\\./FacetedUnitSpec/g' build/vega-lite-schema.json && sed -i -e 's/<Field>//g' build/vega-lite-schema.json",presite:"npm run build && npm run data && npm run build:site && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve",lint:"tslint --project tsconfig.json -c tslint.json --type-check",test:"npm run tsc && npm run schema && npm run test:only && npm run lint",posttest:"npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:debug":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/test build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/vl.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^3.5.2","@types/d3":"^4.8.0","@types/highlight.js":"^9.1.9","@types/json-stable-stringify":"^1.0.31","@types/mocha":"^2.2.41","@types/node":"^7.0.14",ajv:"5.0.1","browser-sync":"^2.18.8",browserify:"^14.3.0","browserify-shim":"^3.8.14",chai:"^3.5.0",cheerio:"^0.22.0",codecov:"^2.1.0",d3:"^4.8.0",exorcist:"^0.4.0","highlight.js":"^9.11.0",mocha:"^3.3.0",nodemon:"^1.11.0",nyc:"^10.3.0","source-map-support":"^0.4.15",tsify:"^3.0.1",tslint:"^5.1.0","tslint-eslint-rules":"^4.0.0",typescript:"^2.3.2","typescript-json-schema":"^0.11.0","uglify-js":"^2.8.22",vega:"3.0.0-beta.30","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"3.0.0-beta.14",watchify:"^3.9.0","yaml-front-matter":"^3.4.0"},dependencies:{"json-stable-stringify":"^1.0.1",tslib:"^1.6.1","vega-event-selector":"^2.0.0-beta","vega-util":"^1.2.0",yargs:"^7.1.0"}}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","ci0","ci1","modeskew","min","max","argmin","argmax"],n.AGGREGATE_OP_INDEX=r.toSet(n.AGGREGATE_OPS),n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=r.toSet(n.SHARED_DOMAIN_OPS)},{"./util":102}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"]},{}],15:[function(e,t,n){"use strict";function r(e){return o.isBoolean(e)?"bin":"bin"+Object.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")}function i(e){switch(e){case a.ROW:case a.COLUMN:case a.SIZE:case a.COLOR:case a.OPACITY:case a.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./channel"),o=e("./util");n.binToString=r,n.autoMaxBins=i},{"./channel":16,"./util":102}],16:[function(e,t,n){"use strict";function r(e){return!!d[e]}function i(e,t){return t in a(e)}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}}function o(e){return!f.contains([n.DETAIL,n.TEXT,n.ORDER,n.TOOLTIP],e)}function s(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in p;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function u(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:return"discrete";case n.COLOR:return"flexible";case n.X2:case n.Y2:case n.DETAIL:case n.TEXT:case n.ORDER:case n.TOOLTIP:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var l,c=e("./scale"),f=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.TOOLTIP="tooltip"}(l=n.Channel||(n.Channel={})),n.X=l.X,n.Y=l.Y,n.X2=l.X2,n.Y2=l.Y2,n.ROW=l.ROW,n.COLUMN=l.COLUMN,n.SHAPE=l.SHAPE,n.SIZE=l.SIZE,n.COLOR=l.COLOR,n.TEXT=l.TEXT,n.DETAIL=l.DETAIL,n.ORDER=l.ORDER,n.OPACITY=l.OPACITY,n.TOOLTIP=l.TOOLTIP,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP];var d=f.toSet(n.CHANNELS);n.isChannel=r,n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.SPATIAL_SCALE_CHANNELS=[n.X,n.Y],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.LEVEL_OF_DETAIL_CHANNELS=f.without(n.NONSPATIAL_CHANNELS,["order"]),n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=i,n.getSupportedMark=a,n.hasScale=o;var p=f.toSet(f.without(c.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=s,n.rangeType=u},{"./scale":93,"./util":102}],17:[function(e,t,n){"use strict";function r(e,t,n,r){var u=e.fieldDef(t),l=e.axis(t),c=e.config;return u.type===a.TEMPORAL&&(n=o.extend({text:{signal:s.timeFormatExpression("datum.value",u.timeUnit,l.format,c.axis.shortTimeLabels,c.timeFormat)}},n)),void 0!==l.labelAngle?n.angle={value:l.labelAngle}:t===i.X&&(o.contains([a.NOMINAL,a.ORDINAL],u.type)||u.bin||u.type===a.TEMPORAL)&&(n.angle={value:270}),n.angle&&(270===n.angle.value?n.align={value:"top"===r.orient?"left":t===i.X?"right":"center"}:90===n.angle.value&&(n.align={value:"center"})),n.angle&&(270===n.angle.value?n.baseline={value:t===i.X?"middle":"bottom"}:90===n.angle.value&&(n.baseline={value:"bottom"})),0===o.keys(n).length?void 0:n}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../type"),o=e("../../util"),s=e("../common");n.labels=r},{"../../channel":16,"../../type":101,"../../util":102,"../common":20}],18:[function(e,t,n){"use strict";function r(e,t){return t.reduce(function(t,n){var r={axes:[],gridAxes:[]};if(e.axis(n)){var i=u(n,e);i&&a(i)&&r.axes.push(i);var o=s(n,e);o&&a(o)&&r.gridAxes.push(o),t[n]=r}return t},{})}function i(e){return!1===e||null===e}function a(e){return m.some(h,function(t){return o(e,t)})}function o(e,t){return"grid"===t||"title"===t?!!e[t]:!i(e[t])}function s(e,t){return l(e,t,!0)}function u(e,t){return l(e,t,!1)}function l(e,t,n){var r=t.axis(e),i={scale:t.scaleName(e)};f.AXIS_PROPERTIES.forEach(function(a){var o=c(a,r,e,t,n);void 0!==o&&(i[a]=o)});var a=c("gridScale",r,e,t,n);void 0!==a&&(i.gridScale=a);var s=r.encode||{};return h.forEach(function(n){if(o(i,n)){var r;r="labels"===n?d.labels(t,e,s.labels||{},i):s[n]||{},void 0!==r&&m.keys(r).length>0&&(i.encode=i.encode||{},i.encode[n]={update:r})}}),i}function c(e,t,n,r,i){var a=r.fieldDef(n);switch(e){case"labels":return!i&&t[e];case"domain":return p.domain(e,t,i,n);case"ticks":return p.ticks(e,t,i,n);case"format":return p.format(t,n,a,r.config);case"grid":return p.grid(r,n,i);case"gridScale":return p.gridScale(r,n,i);case"orient":return p.orient(t,n);case"tickCount":return p.tickCount(t,n,a);case"title":return p.title(t,a,r.config,i);case"values":return p.values(t);case"zindex":return p.zindex(t,i)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../axis"),d=e("./encode"),p=e("./rules"),m=e("../../util"),h=["domain","grid","labels","ticks","title"];n.parseAxisComponent=r,n.parseGridAxis=s,n.parseMainAxis=u},{"../../axis":14,"../../util":102,"./encode":17,"./rules":19}],19:[function(e,t,n){"use strict";function r(e,t,n,r){return y.numberFormat(n,e.format,r,t)}function i(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.hasDiscreteDomain(t)&&!e.fieldDef(t).bin}function a(e,t,n){if(t===m.ROW||t===m.COLUMN)return!1;if(n)return i(e,t)}function o(e,t,n){if(n){var r="x"===t?"y":"x";if(e.scale(r))return e.scaleName(r)}}function s(e,t){var n=e.orient;if(n)return n;switch(t){case m.COLUMN:return"top";case m.X:return"bottom";case m.ROW:case m.Y:return"left"}throw new Error(p.message.INVALID_CHANNEL_FOR_AXIS)}function u(e,t,n){var r=e.tickCount;return void 0!==r?r:t!==m.X||n.bin?void 0:5}function l(e,t,n,r){if(!r&&""!==e.title){if(void 0!==e.title)return e.title;var i=g.title(t,n),a=e.titleMaxLength;return a?v.truncate(i,a):i}}function c(e){var t=e.values;return e.values&&h.isDateTime(t[0])?t.map(function(e){return h.timestamp(e,!0)}):t}function f(e,t){var n=e.zindex;return void 0!==n?n:t?0:1}function d(e,t,n,r){return!n&&r!==m.ROW&&r!==m.COLUMN&&t[e]}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../log"),m=e("../../channel"),h=e("../../datetime"),g=e("../../fielddef"),v=e("../../util"),y=e("../common");n.format=r,n.gridShow=i,n.grid=a,n.gridScale=o,n.orient=s,n.tickCount=u,n.title=l,n.values=c,n.zindex=f,n.domainAndTicks=d,n.domain=d,n.ticks=d},{"../../channel":16,"../../datetime":84,"../../fielddef":87,"../../log":90,"../../util":102,"../common":20}],20:[function(e,t,n){"use strict";function r(e,t,n,r,i,a){if(m.isFacetSpec(e))return new b.FacetModel(e,t,n,i,a);if(m.isLayerSpec(e))return new _.LayerModel(e,t,n,r,i,a);if(m.isUnitSpec(e))return new E.UnitModel(e,t,n,r,i,a);if(m.isRepeatSpec(e))return new S.RepeatModel(e,t,n,i,a);if(m.isConcatSpec(e))return new y.ConcatModel(e,t,n,i,a);throw new Error(f.message.INVALID_SPEC)}function i(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],o=t[a];void 0!==o&&(e[a]={value:o})}return e}function a(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],s=o(a,t.mark(),t.config);void 0!==s&&(e[a]={value:s})}return e}function o(e,t,n){var r=n[t];return void 0!==r[e]?r[e]:n.mark[e]}function s(e,t,n,r,i){if("quantitative"===e.type){var a=u(e,t,r,"text");return e.bin?i?{signal:p.field(e,{expr:n,binSuffix:"range"})}:{signal:"format("+p.field(e,{expr:n,binSuffix:"start"})+", '"+a+"')+'-'+format("+p.field(e,{expr:n,binSuffix:"end"})+", '"+a+"')"}:{signal:"format("+p.field(e,{expr:n})+", '"+a+"')"}}return"temporal"===e.type?{signal:l(p.field(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat)}:{signal:p.field(e,{expr:n})}}function u(e,t,n,r){var i=t;if(e.type===g.QUANTITATIVE)return i||("count"===e.aggregate&&r===d.TEXT?"d":n.numberFormat)}function l(e,t,n,r,i){if(!t||n){return"timeFormat("+e+", '"+(n||i)+"')"}return h.formatExpression(t,e,r)}function c(e){return(v.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(p.field(t,{binSuffix:"start"})),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../log"),d=e("../channel"),p=e("../fielddef"),m=e("../spec"),h=e("../timeunit"),g=e("../type"),v=e("../util"),y=e("./concat"),b=e("./facet"),_=e("./layer"),S=e("./repeat"),E=e("./unit");n.buildModel=r,n.applyConfig=i,n.applyMarkConfig=a,n.getMarkConfig=o,n.formatSignalRef=s,n.numberFormat=u,n.timeFormatExpression=l,n.sortParams=c},{"../channel":16,"../fielddef":87,"../log":90,"../spec":96,"../timeunit":98,"../type":101,"../util":102,"./concat":22,"./facet":38,"./layer":39,"./repeat":58,"./unit":78}],21:[function(e,t,n){"use strict";function r(e,t){t&&l.set(t);try{var n=u.initConfig(e.config),r=c.normalize(e,n),o=d.buildModel(r,null,"",void 0,void 0,n);return o.parse(),a(o,i(e,n))}finally{t&&l.reset()}}function i(e,t){return s.__assign({},f.extractTopLevelProperties(t),f.extractTopLevelProperties(e))}function a(e,t){return{spec:s.__assign({$schema:"http://vega.github.io/schema/vega/v3.0.json"},e.description?{description:e.description}:{},{autosize:"pad"},t,{data:[].concat(e.assembleSelectionData([]),e.assembleData()),signals:[].concat(e.name?[{name:"width",update:e.getName("width")},{name:"height",update:e.getName("height")}]:[],e.assembleLayoutSignals(),e.assembleSelectionTopLevelSignals([]))},o(e))}}function o(e){var t=e.assembleGroup([]),n=t.layout,r=t.signals,i=s.__rest(t,["layout","signals"]),a=i.marks,o=e.assembleParentGroupProperties();return s.__assign({},i,{marks:[s.__assign({name:e.getName("nested_main_group"),type:"group",layout:n,signals:r},o?{encode:{update:o}}:{},{marks:a})]})}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),u=e("../config"),l=e("../log"),c=e("../spec"),f=e("../toplevelprops"),d=e("./common");n.compile=r,n.assembleNestedMainGroup=o},{"../config":82,"../log":90,"../spec":96,"../toplevelprops":99,"./common":20,tslib:10}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../spec"),a=e("../util"),o=e("./common"),s=e("./data/assemble"),u=e("./data/parse"),l=e("./model"),c=function(e){function t(t,n,r,a,s){var u=e.call(this,t,n,r,s)||this;return u.isVConcat=i.isVConcatSpec(t),u.children=(i.isVConcatSpec(t)?t.vconcat:t.hconcat).map(function(e,t){return o.buildModel(e,u,u.getName("concat_"+t),void 0,a,s)}),u}return r.__extends(t,e),t.prototype.parseData=function(){this.component.data=u.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++){var r=n[t];!function(t){t.parseSelection(),a.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(r)}},t.prototype.parseScale=function(){this.component.scales={};this.children.forEach(function(e){e.parseScale()})},t.prototype.parseMark=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMark()}},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseLegend=function(){for(var e=(this.component.legends={},0),t=this.children;e<t.length;e++){t[e].parseLegend()}},t.prototype.assembleData=function(){return this.parent?[]:s.assembleData(a.vals(this.component.data.sources))},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){
return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},[])},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleScales=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleScales())},e.prototype.assembleScales.call(this))},t.prototype.assembleLayout=function(){return r.__assign({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"all"})},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleParentGroupProperties();return r.__assign({type:"group",name:e.getName("group")},t?{encode:{update:t}}:{},e.assembleGroup())})},t}(l.Model);n.ConcatModel=c},{"../spec":96,"../util":102,"./common":20,"./data/assemble":24,"./data/parse":32,"./model":57,tslib:10}],23:[function(e,t,n){"use strict";function r(e,t){return t.bin?(e[o.field(t,{binSuffix:"start"})]=!0,e[o.field(t,{binSuffix:"end"})]=!0,t.type===u.ORDINAL&&(e[o.field(t,{binSuffix:"range"})]=!0)):e[o.field(t)]=!0,e}function i(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=!0:e[n]={op:!0})}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../fielddef"),s=e("../../log"),u=e("../../type"),l=e("../../util"),c=e("./dataflow"),f=function(e){function t(t,n){var r=e.call(this)||this;return r.dimensions=t,r.measures=n,r}return a.__extends(t,e),t.prototype.clone=function(){return new t(l.extend({},this.dimensions),l.duplicate(this.measures))},t.make=function(e){var n=!1;e.forEachFieldDef(function(e){e.aggregate&&(n=!0)});var i={},a={};return n?(e.forEachFieldDef(function(t,n){if(t.aggregate)if("count"===t.aggregate)i["*"]=i["*"]||{},i["*"].count=!0;else{i[t.field]=i[t.field]||{},i[t.field][t.aggregate]=!0;var o=e.scale(n);o&&"unaggregated"===o.domain&&(i[t.field].min=!0,i[t.field].max=!0)}else r(a,t)}),Object.keys(a).length+Object.keys(i).length===0?null:new t(a,i)):null},t.prototype.merge=function(e){l.differ(this.dimensions,e.dimensions)?s.debug("different dimensions, cannot merge"):(i(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return l.keys(this.dimensions).forEach(function(t){return e[t]=!0}),l.keys(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return l.keys(this.measures).forEach(function(n){l.keys(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){var e=this,t=[],n=[];return l.keys(this.measures).forEach(function(r){l.keys(e.measures[r]).forEach(function(e){t.push(e),n.push(r)})}),{type:"aggregate",groupby:l.keys(this.dimensions),ops:t,fields:n}},t}(c.DataFlowNode);n.AggregateNode=f},{"../../fielddef":87,"../../log":90,"../../type":101,"../../util":102,"./dataflow":26,tslib:10}],24:[function(e,t,n){"use strict";function r(e){e instanceof b.NonPositiveFilterNode&&p.every(p.vals(e.filter),function(e){return!1===e})&&e.remove(),e instanceof _.NullFilterNode&&p.every(p.vals(e.filteredFields),function(e){return null===e})&&e.remove(),e instanceof g.OutputNode&&!e.required&&e.remove(),e.children.forEach(r)}function i(e){function t(r){if(!(r instanceof x.OrderNode)){var i=r.clone();if(i instanceof g.OutputNode){var a=n.FACET_SCALE_PREFIX+e.model.getName(i.source);i.source=a,e.model.component.data.outputNodes[a]=i,p.flatten(r.children.map(t)).forEach(function(e){return e.parent=i})}else i instanceof m.AggregateNode||i instanceof T.StackNode?(i.addDimensions(e.fields),p.flatten(r.children.map(t)).forEach(function(e){return e.parent=i})):p.flatten(r.children.map(t)).forEach(function(e){return e.parent=i});return[i]}return p.flatten(r.children.map(t))}return t}function a(e){if(e instanceof v.FacetNode)if(1!==e.numChildren()||e.children[0]instanceof g.OutputNode){o(e.model.component.data.main);var t=p.flatten(e.children.map(i(e)));t.forEach(function(t){return t.parent=e.model.component.data.main})}else{var n=e.children[0];(n instanceof m.AggregateNode||n instanceof T.StackNode)&&n.addDimensions(e.fields),n.swapWithParent(),a(e)}else e.children.forEach(a)}function o(e){if(e instanceof g.OutputNode&&e.type===d.MAIN&&1===e.numChildren()){var t=e.children[0];t instanceof v.FacetNode||(t.swapWithParent(),o(e))}}function s(e){function t(e){0===e.numChildren()?n.push(e):e.children.forEach(t)}var n=[];return e.forEach(t),n}function u(e){function t(r,i){if(r instanceof y.ParseNode&&(r.parent instanceof O.SourceNode&&!i.source?i.format=f.__assign({},i.format||{},{parse:r.assembleFormatParse()}):i.transform=i.transform.concat(r.assembleTransforms())),r instanceof v.FacetNode)return i.name||(i.name="data_"+n++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source,void r.assemble().forEach(function(t){return e.push(t)});if((r instanceof w.FilterNode||r instanceof _.NullFilterNode||r instanceof w.CalculateNode||r instanceof m.AggregateNode||r instanceof x.OrderNode)&&i.transform.push(r.assemble()),(r instanceof b.NonPositiveFilterNode||r instanceof h.BinNode||r instanceof N.TimeUnitNode||r instanceof T.StackNode)&&(i.transform=i.transform.concat(r.assemble())),r instanceof g.OutputNode)if(i.source&&0===i.transform.length)r.source=i.source;else if(r.parent instanceof g.OutputNode)r.source=i.name;else if(i.name||(i.name="data_"+n++),r.source=i.name,1===r.numChildren()&&i.transform.length>0){e.push(i);var a={name:null,source:i.name,transform:[]};i=a}switch(r.numChildren()){case 0:r instanceof g.OutputNode&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:t(r.children[0],i);break;default:var o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source,r.children.forEach(function(e){t(e,{name:null,source:o,transform:[]})})}}var n=0;return t}function l(e){var t=[],n=u(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t}function c(e){var t=[];e.forEach(r),e=e.filter(function(e){return e.numChildren()>0}),s(e).forEach(S.iterateFromLeaves(E.removeUnusedSubtrees)),e=e.filter(function(e){return e.numChildren()>0}),s(e).forEach(S.iterateFromLeaves(E.moveParseUp)),e.forEach(a);var n=u(t),i=0;return e.forEach(function(e){e.hasName()||(e.dataName="source_"+i++);var t=e.assemble();n(e,t)}),t.forEach(function(e){0===e.transform.length&&delete e.transform}),t}Object.defineProperty(n,"__esModule",{value:!0});var f=e("tslib"),d=e("../../data"),p=e("../../util"),m=e("./aggregate"),h=e("./bin"),g=e("./dataflow"),v=e("./facet"),y=e("./formatparse"),b=e("./nonpositivefilter"),_=e("./nullfilter"),S=e("./optimizers"),E=e("./optimizers"),x=e("./pathorder"),O=e("./source"),T=e("./stack"),N=e("./timeunit"),w=e("./transforms");n.FACET_SCALE_PREFIX="scale_",n.assembleFacetData=l,n.assembleData=c},{"../../data":83,"../../util":102,"./aggregate":23,"./bin":25,"./dataflow":26,"./facet":27,"./formatparse":28,"./nonpositivefilter":29,"./nullfilter":30,"./optimizers":31,"./pathorder":33,"./source":34,"./stack":35,"./timeunit":36,"./transforms":37,tslib:10}],25:[function(e,t,n){"use strict";function r(e,t){return"format("+e+", '"+t+"')"}function i(e,t,n,i){if(e.hasDiscreteDomain(n)){var a=e instanceof c.UnitModel?e.axis(n)||e.legend(n)||{}:{},o=l.numberFormat(t,a.format,i,n),u=s.field(t,{expr:"datum",binSuffix:"start"}),f=s.field(t,{expr:"datum",binSuffix:"end"});return{formulaAs:s.field(t,{binSuffix:"range"}),formula:r(u,o)+" + ' - ' + "+r(f,o)}}return{}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../bin"),s=e("../../fielddef"),u=e("../../util"),l=e("../common"),c=e("../unit"),f=e("./dataflow"),d=function(e){function t(t){var n=e.call(this)||this;return n.bins=t,n}return a.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this.bins))},t.make=function(e){var n=e.reduceFieldDef(function(t,n,r){var l=e.fieldDef(r).bin;if(l){var c=u.isBoolean(l)?{}:l,f=o.binToString(n.bin)+"_"+n.field;f in t||(t[f]={bin:c,field:n.field,as:[s.field(n,{binSuffix:"start"}),s.field(n,{binSuffix:"end"})],signal:e.getName(f+"_bins"),extentSignal:e.getName(f+"_extent")}),t[f]=a.__assign({},t[f],i(e,n,r,e.config))}return t},{});return 0===Object.keys(n).length?null:new t(n)},t.prototype.merge=function(e){this.bins=u.extend(e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return u.vals(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return u.vals(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return u.flatten(u.vals(this.bins).map(function(e){var t=[],n=a.__assign({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return e.bin.extent||(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(f.DataFlowNode);n.BinNode=d},{"../../bin":15,"../../fielddef":87,"../../util":102,"../common":20,"../unit":78,"./dataflow":26,tslib:10}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=function(){function e(e){this.debugName=e,this._children=[],this._parent=null}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){var e=this;this._children.forEach(function(t){return t.parent=e._parent}),this._parent.removeChild(this)},e.prototype.swapWithParent=function(){var e=this._parent,t=e.parent;this._children.forEach(function(t){return t.parent=e}),this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}();n.DataFlowNode=i;var a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.type=n,r._refcount=0,r._source=t,r}return r.__extends(t,e),t.prototype.clone=function(){var e=new this.constructor;return e._source=this._source,e.debugName="clone_"+this.debugName,e._refcount=this._refcount,e},Object.defineProperty(t.prototype,"source",{get:function(){return this._refcount++,this._source},set:function(e){this._source=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){return this._refcount>0},enumerable:!0,configurable:!0}),t}(i);n.OutputNode=a},{tslib:10}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../channel"),a=e("./dataflow"),o=function(e){function t(t,n,r){var a=e.call(this)||this;return a.model=t,a.name=n,a.data=r,t.facet.column&&(a.columnField=t.field(i.COLUMN),a.columnName=t.getName("column")),t.facet.row&&(a.rowField=t.field(i.ROW),a.rowName=t.getName("row")),a}return r.__extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){var e=[];return this.columnField&&e.push(this.columnField),this.rowField&&e.push(this.rowField),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this.name},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=[];return this.columnName&&(e.push({name:this.columnName,source:this.data,transform:[{type:"aggregate",groupby:[this.columnField]}]}),e.push({name:this.columnName+"_layout",source:this.columnName,transform:[{type:"aggregate",ops:["distinct"],fields:[this.columnField]}]})),this.rowName&&e.push({name:this.rowName,source:this.data,transform:[{type:"aggregate",groupby:[this.rowField]}]}),e},t}(a.DataFlowNode);n.FacetNode=o},{"../../channel":16,"./dataflow":26,tslib:10}],28:[function(e,t,n){"use strict";function r(e,t){var n="datum["+f.stringValue(e)+"]";if("number"===t)return"toNumber("+n+")";if("boolean"===t)return"toBoolean("+n+")";if("string"===t)return"toString("+n+")";if("date"===t)return"toDate("+n+")";if(0===t.indexOf("date:")){return"timeParse("+n+',"'+t.slice(6,t.length-1)+'")'}return u.warn(u.message.unrecognizedParse(t)),null}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("../../datetime"),o=e("../../fielddef"),s=e("../../filter"),u=e("../../log"),l=e("../../transform"),c=e("../../type"),f=e("../../util"),d=e("../model"),p=e("./dataflow"),m=function(e){function t(t){var n=e.call(this)||this;return n._parse={},n._parse=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(f.duplicate(this.parse))},t.make=function(e){var n={},r=e.transforms.filter(l.isCalculate).reduce(function(e,t){return e[t.as]=!0,e},{});e.transforms.filter(l.isFilter).forEach(function(e){var t=e.filter,r=null;s.isEqualFilter(t)?r=t.equal:s.isRangeFilter(t)?r=t.range[0]:s.isOneOfFilter(t)&&(r=(t.oneOf||t.in)[0]),r&&(a.isDateTime(r)?n[t.field]="date":f.isNumber(r)?n[t.field]="number":f.isString(r)&&(n[t.field]="string"))}),e instanceof d.ModelWithField&&e.forEachFieldDef(function(e){if(e.type===c.TEMPORAL)n[e.field]="date";else if(e.type===c.QUANTITATIVE){if(o.isCount(e)||r[e.field])return;n[e.field]="number"}});var i=e.data;if(i&&i.format&&i.format.parse){var u=i.format.parse;f.keys(u).forEach(function(e){n[e]=u[e]})}return 0===f.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=f.extend(this._parse,e.parse),e.remove()},t.prototype.assembleFormatParse=function(){return this._parse},t.prototype.assembleTransforms=function(){var e=this;return Object.keys(this._parse).map(function(t){var n=r(t,e._parse[t]);return n?{type:"formula",expr:n,as:t}:null}).filter(function(e){return null!==e})},t}(p.DataFlowNode);n.ParseNode=m},{"../../datetime":84,"../../fielddef":87,"../../filter":88,"../../log":90,"../../transform":100,"../../type":101,"../../util":102,"../model":57,"./dataflow":26,tslib:10}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../scale"),a=e("../../util"),o=e("./dataflow"),s=function(e){function t(t){var n=e.call(this)||this;return n._filter=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(a.extend({},this._filter))},t.make=function(e){var n=e.channels().reduce(function(t,n){var r=e.scale(n);return r&&e.field(n)?(t[e.field(n)]=r.type===i.ScaleType.LOG,t):t},{});return Object.keys(n).length?new t(n):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this;return a.keys(this._filter).filter(function(t){return e._filter[t]}).map(function(e){return{type:"filter",expr:'datum["'+e+'"] > 0'}})},t}(o.DataFlowNode);n.NonPositiveFilterNode=s},{"../../scale":93,"../../util":102,"./dataflow":26,tslib:10}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../type"),a=e("../../util"),o=e("./dataflow"),s={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0},u=function(e){function t(t){var n=e.call(this)||this;return n._filteredFields=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(a.duplicate(this._filteredFields))},t.make=function(e){var n=e.reduceFieldDef(function(t,n){return"count"!==n.aggregate&&(e.config.filterInvalid||void 0===e.config.filterInvalid&&n.field&&s[n.type]?t[n.field]=n:t[n.field]=null),t},{});return 0===Object.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"filteredFields",{get:function(){return this._filteredFields},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){var t=this,n=Object.keys(this._filteredFields).map(function(e){return e+" "+a.hash(t._filteredFields[e])}),r=Object.keys(e.filteredFields).map(function(t){return t+" "+a.hash(e.filteredFields[t])});a.differArray(n,r)||(this._filteredFields=a.extend(this._filteredFields,e._filteredFields),e.remove())},t.prototype.assemble=function(){var e=this,t=a.keys(this._filteredFields).reduce(function(t,n){var r=e._filteredFields[n];return null!==r&&(t.push("datum["+a.stringValue(r.field)+"] !== null"),a.contains([i.QUANTITATIVE,i.TEMPORAL],r.type)&&t.push("!isNaN(datum["+a.stringValue(r.field)+"])")),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(o.DataFlowNode);n.NullFilterNode=u},{"../../type":101,"../../util":102,"./dataflow":26,tslib:10}],31:[function(e,t,n){"use strict";function r(e){function t(n){if(!(n instanceof u.SourceNode)){var r=n.parent;e(n)&&t(r)}}return t}function i(e){var t=e.parent;if(e instanceof s.ParseNode){if(t instanceof u.SourceNode)return!1;if(t.numChildren()>1)return!0;t instanceof s.ParseNode?t.merge(e):e.swapWithParent()}return!0}function a(e){e.parent;return!(e instanceof o.OutputNode||e.numChildren()>0)&&(e.remove(),!0)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./dataflow"),s=e("./formatparse"),u=e("./source");n.iterateFromLeaves=r,n.moveParseUp=i,n.removeUnusedSubtrees=a},{"./dataflow":26,"./formatparse":28,"./source":34}],32:[function(e,t,n){"use strict";function r(e,t){if(e.data||!e.parent){var n=new y.SourceNode(e),r=n.hash();return r in t?t[r]:(t[r]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function i(e){var t=r(e,e.component.data.sources),n=e.component.data.outputNodes,i=t,y=m.ParseNode.make(e);y&&(y.parent=t,i=y);var E=e.parent&&e.parent instanceof s.LayerModel;if(e instanceof u.ModelWithField&&E){var x=f.BinNode.make(e);x&&(x.parent=i,i=x)}if(e.transforms.length>0){var O=S.parseTransformArray(e),T=O.first,N=O.last;T.parent=i,i=N}if(e instanceof u.ModelWithField){var w=g.NullFilterNode.make(e);if(w&&(w.parent=i,i=w),!E){var x=f.BinNode.make(e);x&&(x.parent=i,i=x)}var A=_.TimeUnitNode.make(e);A&&(A.parent=i,i=A)}var D=e.getName(a.RAW),M=new d.OutputNode(D,a.RAW);if(n[D]=M,M.parent=i,i=M,e instanceof l.UnitModel){var k=c.AggregateNode.make(e);k&&(k.parent=i,i=k);var C=b.StackNode.make(e);C&&(C.parent=i,i=C);var P=h.NonPositiveFilterNode.make(e);P&&(P.parent=i,i=P)}if(e instanceof l.UnitModel){var R=v.OrderNode.make(e);R&&(R.parent=i,i=R)}var I=e.getName(a.MAIN),L=new d.OutputNode(I,a.MAIN);n[I]=L,L.parent=i,i=L;var U=null;if(e instanceof o.FacetModel){var F=e.getName("facet");U=new p.FacetNode(e,F,L.source),n[F]=U,U.parent=i,i=U}return{sources:e.component.data.sources,outputNodes:n,main:L,facetRoot:U}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../data"),o=e("../facet"),s=e("../layer"),u=e("../model"),l=e("../unit"),c=e("./aggregate"),f=e("./bin"),d=e("./dataflow"),p=e("./facet"),m=e("./formatparse"),h=e("./nonpositivefilter"),g=e("./nullfilter"),v=e("./pathorder"),y=e("./source"),b=e("./stack"),_=e("./timeunit"),S=e("./transforms");n.parseData=i},{"../../data":83,"../facet":38,"../layer":39,"../model":57,"../unit":78,"./aggregate":23,"./bin":25,"./dataflow":26,"./facet":27,"./formatparse":28,"./nonpositivefilter":29,"./nullfilter":30,"./pathorder":33,"./source":34,"./stack":35,"./timeunit":36,"./transforms":37}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../encoding"),a=e("../../fielddef"),o=e("../../sort"),s=e("../../util"),u=e("../common"),l=e("./dataflow"),c=function(e){function t(t){var n=e.call(this)||this;return n.sort=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this.sort))},t.make=function(e){var n=null;if(!s.contains(["line","area"],e.mark()))return null;if("line"===e.mark()&&e.channelHasField("order"))n=u.sortParams(e.encoding.order);else{var r="horizontal"===e.markDef.orient?"y":"x",l=e.sort(r);n={field:o.isSortField(l)?a.field({aggregate:i.isAggregate(e.encoding)?l.op:void 0,field:l.field}):e.field(r,{binSuffix:"start"}),order:"descending"}}return new t(n)},t.prototype.assemble=function(){return{type:"collect",sort:this.sort}},t}(l.DataFlowNode);n.OrderNode=c},{"../../encoding":85,"../../fielddef":87,"../../sort":95,"../../util":102,"../common":20,"./dataflow":26,tslib:10}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../data"),a=e("../../util"),o=e("./dataflow"),s=function(e){function t(t){var n=e.call(this)||this,o=t.data||{name:"source"};if(i.isInlineData(o))n._data={values:o.values,format:{type:"json"}};else if(i.isUrlData(o)){var s=/(?:\.([^.]+))?$/.exec(o.url)[1];a.contains(["json","csv","tsv","topojson"],s)||(s="json");var u=o.format||{},l=u.type||o.formatType,c=u.property,f=u.feature,d=u.mesh,p=r.__assign({type:l||s},c?{property:c}:{},f?{feature:f}:{},d?{mesh:d}:{});n._data={url:o.url,format:p}}else i.isNamedData(o)&&(n._name=o.name,n._data={});return n}return r.__extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},t.prototype.hash=function(){return i.isInlineData(this._data)?a.hash(this._data):i.isUrlData(this._data)?this._data.url+" "+a.hash(this._data.format):this._name},t.prototype.assemble=function(){return r.__assign({name:this._name},this._data,{transform:[]})},t}(o.DataFlowNode);n.SourceNode=s},{"../../data":83,"../../util":102,"./dataflow":26,tslib:10}],35:[function(e,t,n){"use strict";function r(e){return e.stack.stackBy.reduce(function(t,n){var r=n.channel,i=n.fieldDef,a=e.scale(r),u=o.field(i,{binSuffix:a&&s.hasDiscreteDomain(a.type)?"range":"start"});return u&&t.push(u),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("vega-util"),o=e("../../fielddef"),s=e("../../scale"),u=e("../../util"),l=e("../common"),c=e("./dataflow"),f=function(e){function t(t){var n=e.call(this)||this;return n._stack=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this._stack))},t.make=function(e){var n=e.stack;if(!n)return null;var i=[];if(n.groupbyChannel){e.fieldDef(n.groupbyChannel).bin?(i.push(e.field(n.groupbyChannel,{binSuffix:"start"})),i.push(e.field(n.groupbyChannel,{binSuffix:"end"}))):i.push(e.field(n.groupbyChannel))}var a,o=r(e),s=e.encoding.order;return a=s?l.sortParams(s):o.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new t({groupby:i,field:e.field(n.fieldChannel),stackby:o,sort:a,offset:n.offset,impute:u.contains(["area","line"],e.mark())})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.groupby=this._stack.groupby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.field]=!0,this._stack.groupby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return a.isArray(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},t.prototype.assemble=function(){var e=[],t=this._stack;return t.impute&&e.push({type:"impute",field:t.field,groupby:t.stackby,orderby:t.groupby,method:"value",value:0}),e.push({type:"stack",groupby:t.groupby,field:t.field,sort:t.sort,as:[t.field+"_start",t.field+"_end"],offset:t.offset}),e},t}(c.DataFlowNode);n.StackNode=f},{"../../fielddef":87,"../../scale":93,"../../util":102,"../common":20,"./dataflow":26,tslib:10,"vega-util":106}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../fielddef"),a=e("../../timeunit"),o=e("../../type"),s=e("../../util"),u=e("./dataflow"),l=function(e){function t(t){var n=e.call(this)||this;return n.formula=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this.formula))},t.make=function(e){var n=e.reduceFieldDef(function(e,t){if(t.type===o.TEMPORAL&&t.timeUnit){var n=i.field(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===Object.keys(n).length?null:new t(n)},t.prototype.merge=function(e){this.formula=s.extend(this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return s.vals(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return s.vals(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return s.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:a.fieldExpr(e.timeUnit,e.field)}})},t}(u.DataFlowNode);n.TimeUnitNode=l},{"../../fielddef":87,"../../timeunit":98,"../../type":101,"../../util":102,"./dataflow":26,tslib:10}],37:[function(e,t,n){"use strict";function r(e){var t,n,r,i;return e.transforms.forEach(function(n,a){if(s.isCalculate(n))r=new f(n);else{if(!s.isFilter(n))return void o.warn(o.message.invalidTransformIgnored(n));r=new c(e,n.filter)}0===a?t=r:r.parent=i,i=r}),n=r,{first:t,last:n}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("../../filter"),o=e("../../log"),s=e("../../transform"),u=e("../../util"),l=e("./dataflow"),c=function(e){function t(t,n){var r=e.call(this)||this;return r.model=t,r.filter=n,r}return i.__extends(t,e),t.prototype.clone=function(){return new t(this.model,u.duplicate(this.filter))},t.prototype.assemble=function(){return{type:"filter",expr:a.expression(this.model,this.filter)}},t}(l.DataFlowNode);n.FilterNode=c;var f=function(e){function t(t){var n=e.call(this)||this;return n.transform=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this.transform))},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(l.DataFlowNode);n.CalculateNode=f,n.parseTransformArray=r},{"../../filter":88,"../../log":90,"../../transform":100,"../../util":102,"./dataflow":26,tslib:10}],38:[function(e,t,n){"use strict";function r(e){var t=e.child.assembleParentGroupProperties();return i.__assign({},t||{},d.applyConfig({},e.config.facet.cell,l.FILL_STROKE_CONFIG.concat(["clip"])))}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("../channel"),o=e("../encoding"),s=e("../fielddef"),u=e("../log"),l=e("../mark"),c=e("../util"),f=e("../vega.schema"),d=e("./common"),p=e("./data/assemble"),m=e("./data/parse"),h=e("./layout/header"),g=e("./model"),v=e("./repeat"),y=function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,a)||this;o.child=d.buildModel(t.spec,o,o.getName("child"),void 0,i,a),o.children=[o.child];var s=v.replaceRepeaterInFacet(t.facet,i);return o.facet=o.initFacet(s),o}return i.__extends(t,e),t.prototype.initFacet=function(e){return o.reduce(e,function(e,t,n){return c.contains([a.ROW,a.COLUMN],n)?void 0===t.field?(u.warn(u.message.emptyFieldDef(t,n)),e):(e[n]=s.normalize(t,n),e):(u.warn(u.message.incompatibleChannel(n,"facet")),e)},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.hasDiscreteDomain=function(e){return!0},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=m.parseData(this),this.child.parseData()},t.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},t.prototype.parseScale=function(){var e=this,t=this.child,n=this;t.parseScale();var r=this.component.scales={};c.keys(t.component.scales).forEach(function(a){var o=r[a]=t.component.scales[a],s=o.name.substr(t.getName("").length),u=n.scaleName(s,!0);t.renameScale(o.name,u),o.name=u;var l=o.domain;f.isDataRefDomain(l)||f.isFieldRefUnionDomain(l)?l.data=p.FACET_SCALE_PREFIX+e.getName(l.data):f.isDataRefUnionedDomain(l)&&(l.fields=l.fields.map(function(t){return i.__assign({},t,{data:p.FACET_SCALE_PREFIX+e.getName(t.data)})})),delete t.component.scales[a]})},t.prototype.parseMark=function(){this.child.parseMark(),this.component.mark=[{name:this.getName("cell"),type:"group",from:{facet:{name:this.component.data.facetRoot.name,data:this.component.data.facetRoot.data,groupby:[].concat(this.channelHasField(a.ROW)?[this.field(a.ROW)]:[],this.channelHasField(a.COLUMN)?[this.field(a.COLUMN)]:[])}},encode:{update:r(this)}}]},t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},r=void 0!==n.title?n.title:s.title(t,this.config);this.child.component.layoutHeaders[e].title&&(r+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:r,fieldRef:d.formatSignalRef(t,n.format,"parent",this.config,!0),header:[this.makeHeaderComponent(e,!0)]}}},t.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.getSizeSignalRef(n),axes:[]}},t.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]){for(var n="x"===e?"column":"row",r=this.component.layoutHeaders[n],i=0,a=t.component.axes[e].axes;i<a.length;i++){var o=a[i],s=h.getHeaderType(o.orient);r[s]=r[s]||[this.makeHeaderComponent(n,!1)],r[s][0].axes.push(o)}t.component.axes[e].axes=[]}},t.prototype.parseLegend=function(){this.child.parseLegend(),this.component.legends=this.child.component.legends,this.child.component.legends={}},t.prototype.assembleData=function(){return this.parent?[]:p.assembleData(c.vals(this.component.data.sources))},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},t.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.channelHasField("column")?{signal:this.columnDistinctSignal()}:1,bounds:"full"}},t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},t.prototype.columnDistinctSignal=function(){var e=this.getName("column")+"_layout",t=this.field("column",{prefix:"distinct"});return"data('"+e+"')[0]["+c.stringValue(t)+"]"},t.prototype.assembleMarks=function(){var e=this.component.data.facetRoot,t=p.assembleFacetData(e),n=this.component.mark[0];return n.from.facet=i.__assign({},n.from.facet,{name:e.name,data:e.data}),[i.__assign({},t.length>0?{data:t}:{},n,this.child.assembleGroup())].map(this.correctDataNames)},t.prototype.channels=function(){return[a.ROW,a.COLUMN]},t.prototype.getMapping=function(){return this.facet},t}(g.ModelWithField);n.FacetModel=y},{"../channel":16,"../encoding":85,"../fielddef":87,"../log":90,"../mark":91,"../util":102,"../vega.schema":104,"./common":20,"./data/assemble":24,"./data/parse":32,
"./layout/header":40,"./model":57,"./repeat":58,tslib:10}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../mark"),a=e("../resolve"),o=e("../util"),s=e("../vega.schema"),u=e("./common"),l=e("./data/assemble"),c=e("./data/parse"),f=e("./layout/index"),d=e("./model"),p=e("./scale/domain"),m=e("./selection/selection"),h=function(e){function t(t,n,i,o,s,l){var c=e.call(this,t,n,i,l)||this;c.resolve=a.initLayerResolve(t.resolve||{});var f=r.__assign({},o,t.width?{width:t.width}:{},t.height?{height:t.height}:{});return c.children=t.layer.map(function(e,t){return u.buildModel(e,c,c.getName("layer_"+t),f,s,l)}),c}return r.__extends(t,e),t.prototype.parseData=function(){this.component.data=c.parseData(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++){var r=n[t];!function(t){t.parseSelection(),o.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(r)}},t.prototype.parseScale=function(){for(var e=this,t=this,n=this.component.scales={},r=0,i=this.children;r<i.length;r++){var a=i[r];!function(r){r.parseScale(),o.keys(r.component.scales).forEach(function(i){if("shared"===e.resolve[i].scale){var a=r.component.scales[i],o=n[i];if(!a||s.isSignalRefDomain(a.domain)||o&&s.isSignalRefDomain(o.domain))return;o?o.domain=p.unionDomains(o.domain,a.domain):n[i]=a;var u=a.name.substr(r.getName("").length),l=t.scaleName(u,!0);r.renameScale(a.name,l),a.name=l,delete r.component.scales[i]}})}(a)}},t.prototype.parseMark=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMark()}},t.prototype.parseAxisAndHeader=function(){for(var e=this,t=this.component.axes={},n=0,i=this.children;n<i.length;n++){var a=i[n];!function(n){n.parseAxisAndHeader(),o.keys(n.component.axes).forEach(function(i){"shared"===e.resolve[i].axis?t[i]||(t[i]=n.component.axes[i]):t[i]?(t[i].axes.push(r.__assign({},n.component.axes[i].axes[0],t[i].axes.length%2==1?{orient:"y"===i?"right":"top"}:{})),n.component.axes[i].gridAxes.length>0&&t[i].gridAxes.push(r.__assign({},n.component.axes[i].gridAxes[0]))):t[i]=n.component.axes[i]})}(a)}},t.prototype.parseLegend=function(){for(var e=this,t=this.component.legends={},n=0,r=this.children;n<r.length;n++){var i=r[n];!function(n){n.parseLegend(),o.keys(n.component.legends).forEach(function(r){"shared"===e.resolve[r].legend&&(t[r]||(t[r]=n.component.legends[r]))})}(i)}},t.prototype.assembleParentGroupProperties=function(){return r.__assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},u.applyConfig({},this.config.cell,i.FILL_STROKE_CONFIG.concat(["clip"])))},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},f.assembleLayoutLayerSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleData=function(){return this.parent?[]:l.assembleData(o.vals(this.component.data.sources))},t.prototype.assembleScales=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleScales())},e.prototype.assembleScales.call(this))},t.prototype.assembleLayout=function(){return null},t.prototype.assembleMarks=function(){return m.assembleLayerSelectionMarks(this,o.flatten(this.children.map(function(e){return e.assembleMarks()})))},t}(d.Model);n.LayerModel=h},{"../mark":91,"../resolve":92,"../util":102,"../vega.schema":104,"./common":20,"./data/assemble":24,"./data/parse":32,"./layout/index":41,"./model":57,"./scale/domain":60,"./selection/selection":68,tslib:10}],40:[function(e,t,n){"use strict";function r(e){return"top"===e||"left"===e?"header":"footer"}function i(e,t){var n="row"===t?"height":"width",r=e.component.layoutHeaders[t].title,i="row"===t?"y":"x",a="row"===t?"right":"center",s="row"===t?"vertical":void 0;return{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[{type:"text",role:t+"-title-text",encode:{update:o.__assign((u={},u[i]={signal:"0.5 * "+n},u.align={value:a},u.text={value:r},u.fill={value:"black"},u.fontWeight={value:"bold"},u),"vertical"===s?{angle:{value:270}}:{})}}]};var u}function a(e,t,n,r,i){if(i){var a=null;r.fieldRef&&i.labels&&(a={text:r.fieldRef,offset:10,orient:"row"===t?"left":"top",encode:{update:o.__assign({fontWeight:{value:"normal"},angle:{value:0},fontSize:{value:10}},"row"===t?{align:{value:"right"},baseline:{value:"middle"}}:{})}});var s=i.axes,u=s&&s.length>0;if(a||u){var l="row"===t?"height":"width";return o.__assign({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.fieldRef?{from:{data:e.getName(t)}}:{},a?{title:a}:{},{encode:{update:(c={},c[l]=i.sizeSignal,c)}},u?{axes:s}:{})}}return null;var c}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib");n.HEADER_CHANNELS=["row","column"],n.HEADER_TYPES=["header","footer"],n.getHeaderType=r,n.getTitleGroup=i,n.getHeaderGroup=a},{tslib:10}],41:[function(e,t,n){"use strict";function r(e){return[{name:e.getName("width"),update:i(e,"width")},{name:e.getName("height"),update:i(e,"height")}]}function i(e,t){return"max("+e.children.map(function(e){return e.getName(t)}).join(", ")+")"}function a(e){return[{name:e.getName("width"),update:o(e,"width")},{name:e.getName("height"),update:o(e,"height")}]}function o(e,t){var n="width"===t?"x":"y",r=e.scale(n);if(r&&s.hasDiscreteDomain(r.type)&&r.rangeStep){var i=e.scaleName(n),a="domain('"+i+"').length",o=void 0!==r.paddingOuter?r.paddingOuter:r.padding;return"bandspace("+a+", "+("band"===r.type?void 0!==r.paddingInner?r.paddingInner:r.padding:1)+", "+o+") * "+r.rangeStep}return""+e[t]}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../scale");n.assembleLayoutLayerSignals=r,n.layerSizeExpr=i,n.assembleLayoutUnitSignals=a,n.unitSizeExpr=o},{"../../scale":93}],42:[function(e,t,n){"use strict";function r(e,t,n,r){var i={},u=n.mark();switch(u){case s.BAR:case s.TICK:case s.TEXT:i.shape={value:"square"};break;case s.CIRCLE:case s.SQUARE:i.shape={value:u};break;case s.POINT:case s.LINE:case s.AREA:}var d=(n.config,n.markDef.filled),p=r===a.COLOR?l.without(s.FILL_STROKE_CONFIG,[d?"fill":"stroke","strokeDash","strokeDashOffset"]):s.FILL_STROKE_CONFIG;if(p=l.without(p,["strokeDash","strokeDashOffset"]),c.applyMarkConfig(i,n,p),r!==a.COLOR){var m=f.color(n);m.fill&&o.isFieldDef(m.fill)&&delete m.fill,m.stroke&&o.isFieldDef(m.stroke)&&delete m.stroke,l.extend(i,m)}if(r!==a.SHAPE){var h=n.encoding.shape;o.isValueDef(h)&&(i.shape={value:h.value})}return i=l.extend(i,t||{}),l.keys(i).length>0?i:void 0}function i(e,t,n,r){var i=n.legend(r),a=n.config,o={};return e.type===u.TEMPORAL&&(t=l.extend({text:{signal:c.timeFormatExpression("datum.value",e.timeUnit,i.format,a.legend.shortTimeLabels,a.timeFormat)}},t||{})),o=l.extend(o,t||{}),l.keys(o).length>0?o:void 0}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../fielddef"),s=e("../../mark"),u=e("../../type"),l=e("../../util"),c=e("../common"),f=e("../mark/mixins");n.symbols=r,n.labels=i},{"../../channel":16,"../../fielddef":87,"../../mark":91,"../../type":101,"../../util":102,"../common":20,"../mark/mixins":50}],43:[function(e,t,n){"use strict";function r(e){return[s.COLOR,s.SIZE,s.SHAPE,s.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=a(e,n)),t},{})}function i(e,t){switch(t){case s.COLOR:var n=e.scaleName(s.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case s.SIZE:return{size:e.scaleName(s.SIZE)};case s.SHAPE:return{shape:e.scaleName(s.SHAPE)};case s.OPACITY:return{opacity:e.scaleName(s.OPACITY)}}return null}function a(e,t){var n=e.fieldDef(t),r=e.legend(t),a=i(e,t);u.LEGEND_PROPERTIES.forEach(function(n){var i=o(n,r,t,e);void 0!==i&&(a[n]=i)});var s=r.encode||{};return["labels","legend","title","symbols"].forEach(function(r){var i=f[r]?f[r](n,s[r],e,t):s[r];void 0!==i&&l.keys(i).length>0&&(a.encode=a.encode||{},a.encode[r]={update:i})}),a}function o(e,t,n,r){var i=r.fieldDef(n);switch(e){case"format":return c.numberFormat(i,t.format,r.config,n);case"title":return d.title(t,i,r.config);case"values":return d.values(t);case"type":return d.type(t,i.type,n,r.scale(n).type)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),u=e("../../legend"),l=e("../../util"),c=e("../common"),f=e("./encode"),d=e("./rules");n.parseLegendComponent=r,n.parseLegend=a},{"../../channel":16,"../../legend":89,"../../util":102,"../common":20,"./encode":42,"./rules":44}],44:[function(e,t,n){"use strict";function r(e,t,n){return void 0!==e.title?e.title:u.title(t,n)}function i(e){var t=e.values;return t&&s.isDateTime(t[0])?t.map(function(e){return s.timestamp(e,!0)}):t}function a(e,t,n,r){return e.type?e.type:n===o.COLOR&&("quantitative"===t&&!l.isBinScale(r)||"temporal"===t&&c.contains(["time","utc"],r))?"gradient":void 0}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../datetime"),u=e("../../fielddef"),l=e("../../scale"),c=e("../../util");n.title=r,n.values=i,n.type=a},{"../../channel":16,"../../datetime":84,"../../fielddef":87,"../../scale":93,"../../util":102}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins");n.area={vgMark:"area",defaultRole:void 0,encodeEntry:function(e){return r.__assign({},i.pointPosition("x",e,"zeroOrMin"),i.pointPosition("y",e,"zeroOrMin"),i.pointPosition2(e,"zeroOrMin"),i.color(e),i.text(e,"tooltip"),i.nonPosition("opacity",e),i.markDefProperties(e.markDef,["orient","interpolate","tension"]))}}},{"./mixins":50,tslib:10}],46:[function(e,t,n){"use strict";function r(e,t){var n=e.config,r=e.width,i=e.markDef.orient,l=e.encoding.size,p=e.encoding.x,m=e.scaleName(s.X),h=e.scale(s.X);if("horizontal"===i)return o.__assign({},f.pointPosition("x",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(p)){if(!l&&c.isBinScale(h.type))return f.binnedPosition("x",e,n.bar.binSpacing);if(h.type===c.ScaleType.BAND)return f.bandPosition("x",e)}return f.centeredBandPosition("x",e,o.__assign({},d.midX(r,n)),a(m,e.scale(s.X),n))}function i(e,t){var n=e.config,r=e.encoding,i=e.height,l=e.markDef.orient,p=r.size,m=r.y,h=e.scaleName(s.Y),g=e.scale(s.Y);if("vertical"===l)return o.__assign({},f.pointPosition("y",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(m)){if(m.bin&&!p)return f.binnedPosition("y",e,n.bar.binSpacing);if(g.type===c.ScaleType.BAND)return f.bandPosition("y",e)}return f.centeredBandPosition("y",e,d.midY(i,n),a(h,e.scale(s.Y),n))}function a(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){if(t.type!==c.ScaleType.POINT)return t.type===c.ScaleType.BAND?d.band(e):{value:n.bar.continuousBandSize};if(null!==t.rangeStep)return{value:t.rangeStep-1};l.warn(l.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../channel"),u=e("../../fielddef"),l=e("../../log"),c=e("../../scale"),f=e("./mixins"),d=e("./valueref");n.bar={vgMark:"rect",defaultRole:"bar",encodeEntry:function(e){var t=e.stack;return o.__assign({},r(e,t),i(e,t),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e))}}},{"../../channel":16,"../../fielddef":87,"../../log":90,"../../scale":93,"./mixins":50,"./valueref":56,tslib:10}],47:[function(e,t,n){"use strict";function r(e,t,n,r){var i=d.isMarkDef(e)?u.__assign({},e):{type:e},a=i.orient||g.getMarkConfig("orient",i.type,r);return i.orient=s(i.type,t,n,a),void 0!==a&&a!==i.orient&&f.warn(f.message.orientOverridden(i.orient,a)),void 0===i.filled&&(i.filled=o(i.type,r)),i}function i(e,t,n,r){var i=g.getMarkConfig("opacity",e,r);if(!t.opacity&&void 0===i){var o=a(e,t,n);void 0!==o&&(t.opacity={value:o})}return t}function a(e,t,n){if(h.contains([d.POINT,d.TICK,d.CIRCLE,d.SQUARE],e)&&!l.isAggregate(t))return.7}function o(e,t){var n=g.getMarkConfig("filled",e,t);return void 0!==n?n:e!==d.POINT&&e!==d.LINE&&e!==d.RULE}function s(e,t,n,r){switch(e){case d.POINT:case d.CIRCLE:case d.SQUARE:case d.TEXT:case d.RECT:return}var i=t.y&&t.y2,a=t.x&&t.x2;switch(e){case d.TICK:var o=n.x?n.x.type:null,s=n.y?n.y.type:null;return!p.hasDiscreteDomain(o)&&(!t.y||p.hasDiscreteDomain(s)||c.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case d.RULE:case d.BAR:case d.AREA:if(i)return"vertical";if(a)return"horizontal";if(e===d.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case d.LINE:var u=c.isFieldDef(t.x)&&c.isContinuous(t.x),l=c.isFieldDef(t.y)&&c.isContinuous(t.y);if(u&&!l)return"horizontal";if(!u&&l)return"vertical";if(u&&l){var h=t.x,g=t.y,v=h.type===m.TEMPORAL,y=g.type===m.TEMPORAL;return v&&!y?"vertical":!v&&y?"horizontal":!h.aggregate&&g.aggregate?"vertical":h.aggregate&&!g.aggregate?"horizontal":r||(e===d.LINE&&t.order||f.warn(f.message.unclearOrientContinuous(e)),"vertical")}return void f.warn(f.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),l=e("../../encoding"),c=e("../../fielddef"),f=e("../../log"),d=e("../../mark"),p=e("../../scale"),m=e("../../type"),h=e("../../util"),g=e("../common");n.initMarkDef=r,n.initEncoding=i},{"../../encoding":85,"../../fielddef":87,"../../log":90,"../../mark":91,"../../scale":93,"../../type":101,"../../util":102,"../common":20,tslib:10}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins");n.line={vgMark:"line",defaultRole:void 0,encodeEntry:function(e){return r.__assign({},i.pointPosition("x",e,"zeroOrMin"),i.pointPosition("y",e,"zeroOrMin"),i.color(e),i.text(e,"tooltip"),i.nonPosition("opacity",e),i.nonPosition("size",e,{vgChannel:"strokeWidth"}),i.markDefProperties(e.markDef,["interpolate","tension"]))}}},{"./mixins":50,tslib:10}],49:[function(e,t,n){"use strict";function r(e){return f.contains([c.LINE,c.AREA],e.mark())?i(e):a(e)}function i(e){var t=e.mark(),n=o(e),r=[u.__assign({name:e.getName("marks"),type:x[t].vgMark},s(e),{from:{data:(n.length>0?O:"")+e.requestDataName(_.MAIN)},encode:{update:x[t].encodeEntry(e)}})];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:O+e.requestDataName(_.MAIN),data:e.requestDataName(_.MAIN),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}function a(e){var t=e.mark(),n=e.markDef.role||x[t].defaultRole,r=[];return r.push(u.__assign({name:e.getName("marks"),type:x[t].vgMark},s(e),n?{role:n}:{},{from:{data:e.requestDataName(_.MAIN)},encode:{update:x[t].encodeEntry(e)}})),r}function o(e){return l.LEVEL_OF_DETAIL_CHANNELS.reduce(function(t,n){return e.channelHasField(n)&&!e.fieldDef(n).aggregate&&t.push(e.field(n)),t},[])}function s(e){var t=e.scale(S.X),n=e.scale(S.Y);return t&&E.isSelectionDomain(t.domain)||n&&E.isSelectionDomain(n.domain)?{clip:!0}:{}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),l=e("../../channel"),c=e("../../mark"),f=e("../../util"),d=e("./area"),p=e("./bar"),m=e("./line"),h=e("./point"),g=e("./rect"),v=e("./rule"),y=e("./text"),b=e("./tick"),_=e("../../data"),S=e("../../channel"),E=e("../../scale"),x={area:d.area,bar:p.bar,line:m.line,point:h.point,text:y.text,tick:b.tick,rect:g.rect,rule:v.rule,circle:h.circle,square:h.square};n.parseMark=r;var O="faceted_path_"},{"../../channel":16,"../../data":83,"../../mark":91,"../../scale":93,"../../util":102,"./area":45,"./bar":46,"./line":48,"./point":51,"./rect":52,"./rule":53,"./text":54,"./tick":55,tslib:10}],50:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.filled,r=o("color",e,{vgChannel:n?"fill":"stroke",defaultValue:v.getMarkConfig("color",e.mark(),t)});return!r.fill&&g.contains(["bar","point","circle","square"],e.mark())&&(r.fill={value:"transparent"}),r}function i(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]={value:e[n]}),t},{})}function a(e,t){if(void 0!==t)return n={},n[e]={value:t},n;return;var n}function o(e,t,n){void 0===n&&(n={});var r=n.defaultValue,i=n.vgChannel,a=n.defaultRef||(void 0!==r?{value:r}:void 0),o=t.encoding[e],u=y.midPoint(e,o,t.scaleName(e),t.scale(e),a);return s(t,o&&o.condition,i||e,u)}function s(e,t,n,r){if(t){var i=t.selection,a=t.value;return o={},o[n]=[{test:u(e,i),value:a}].concat(void 0!==r?[r]:[]),o}return void 0!==r?(s={},s[n]=r,s):{};var o,s}function u(e,t){var n="!"===t.charAt(0),r=n?t.slice(1):t,i=e.getComponent("selection",r);return(n?"!":"")+b.predicate(i.name,i.type,i.resolve)}function l(e,t){void 0===t&&(t="text");var n=e.encoding[t],r="tooltip"!==t||n?y.text(n,e.config):void 0;return s(e,n&&n.condition,t,r)}function c(e,t){var n=t.encoding[e],r=t.scaleName(e),i="x"===e?"width":"height";return a={},a[e]=y.fieldRef(n,r,{}),a[i]=y.band(r),a;var a}function f(e,t,n,r){var i="x"===e?"xc":"yc",a="x"===e?"width":"height";return h.__assign({},p(e,t,n,i),o("size",t,{defaultRef:r,vgChannel:a}))}function d(e,t,n){var r=t.encoding[e],i=t.scaleName(e);return"x"===e?{x2:y.bin(r,i,"start",n),x:y.bin(r,i,"end")}:{y2:y.bin(r,i,"start"),y:y.bin(r,i,"end",n)}}function p(e,t,n,r){var i=t.encoding,a=t.stack,o=y.stackable(e,i[e],t.scaleName(e),t.scale(e),a,n);return s={},s[r||e]=o,s;var s}function m(e,t,n){var r=e.encoding,i=e.markDef,a=e.stack;n=n||("horizontal"===i.orient?"x2":"y2");var o="x2"===n?"x":"y",s=y.stackable2(n,r[o],r[n],e.scaleName(o),e.scale(o),a,t);return u={},u[n]=s,u;var u}Object.defineProperty(n,"__esModule",{value:!0});var h=e("tslib"),g=e("../../util"),v=e("../common"),y=e("./valueref"),b=e("../selection/selection");n.color=r,n.markDefProperties=i,n.valueIfDefined=a,n.nonPosition=o,n.text=l,n.bandPosition=c,n.centeredBandPosition=f,n.binnedPosition=d,n.pointPosition=p,n.pointPosition2=m},{"../../util":102,"../common":20,"../selection/selection":68,"./valueref":56,tslib:10}],51:[function(e,t,n){"use strict";function r(e,t){var n=e.config,r=e.width,s=e.height;return a.__assign({},o.pointPosition("x",e,u.midX(r,n)),o.pointPosition("y",e,u.midY(s,n)),o.color(e),o.text(e,"tooltip"),o.nonPosition("size",e),i(e,n,t),o.nonPosition("opacity",e))}function i(e,t,n){return n?{shape:{value:n}}:o.nonPosition("shape",e,{defaultValue:s.getMarkConfig("shape","point",t)})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("./mixins"),s=e("../common"),u=e("./valueref");n.shapeMixins=i,n.point={vgMark:"symbol",defaultRole:"point",encodeEntry:function(e){return r(e)}},n.circle={vgMark:"symbol",defaultRole:"circle",encodeEntry:function(e){return r(e,"circle")}},n.square={vgMark:"symbol",defaultRole:"square",encodeEntry:function(e){return r(e,"square")}}},{"../common":20,"./mixins":50,"./valueref":56,tslib:10}],52:[function(e,t,n){"use strict";function r(e){var t=e.encoding.x,n=e.encoding.x2,r=e.scale(o.X);if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("x",e,0);if(r&&c.hasDiscreteDomain(r.type)){if(r.type===c.ScaleType.BAND)return f.bandPosition("x",e);throw new Error(u.message.scaleTypeNotWorkWithMark(l.RECT,r.type))}return a.__assign({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}function i(e){var t=e.encoding.y,n=e.encoding.y2,r=e.scale(o.Y);if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("y",e,0);if(r&&c.hasDiscreteDomain(r.type)){if(r.type===c.ScaleType.BAND)return f.bandPosition("y",e);throw new Error(u.message.scaleTypeNotWorkWithMark(l.RECT,r.type))}return a.__assign({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),u=e("../../log"),l=e("../../mark"),c=e("../../scale"),f=e("./mixins");n.rect={vgMark:"rect",defaultRole:void 0,encodeEntry:function(e){return a.__assign({},r(e),i(e),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e))}}},{"../../channel":16,"../../fielddef":87,"../../log":90,"../../mark":91,"../../scale":93,"./mixins":50,tslib:10}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins"),a=e("./valueref");n.rule={vgMark:"rule",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.markDef,o=e.width,s=e.height,u=n.orient;return r.__assign({},i.pointPosition("x",e,"horizontal"===u?"zeroOrMin":a.midX(o,t)),i.pointPosition("y",e,"vertical"===u?"zeroOrMin":a.midY(s,t)),i.pointPosition2(e,"zeroOrMax"),i.color(e),i.text(e,"tooltip"),i.nonPosition("opacity",e),i.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":50,"./valueref":56,tslib:10}],54:[function(e,t,n){"use strict";function r(e,t){return u.isFieldDef(t)&&t.type===l.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function i(e,t){if(void 0===s.getMarkConfig("align","text",t))return f.channelHasField(e,o.X)?"center":"right"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../common"),u=e("../../fielddef"),l=e("../../type"),c=e("./mixins"),f=e("../../encoding"),d=e("./valueref");n.text={vgMark:"text",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.encoding,o=e.height,s=n.text;return a.__assign({},c.pointPosition("x",e,r(t,s)),c.pointPosition("y",e,d.midY(o,t)),c.text(e),c.color(e),c.text(e,"tooltip"),c.nonPosition("opacity",e),c.nonPosition("size",e,{vgChannel:"fontSize"}),c.valueIfDefined("align",i(n,t)))}}},{"../../channel":16,"../../encoding":85,"../../fielddef":87,"../../type":101,"../common":20,"./mixins":50,"./valueref":56,tslib:10}],55:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.orient,r=(e.scale("horizontal"===n?"x":"y")||{}).rangeStep;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var i=void 0!==r?r:t.scale.rangeStep;if("number"!=typeof i)throw new Error("Function does not handle non-numeric rangeStep");return i/1.5}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("./mixins"),o=e("./valueref");n.tick={vgMark:"rect",defaultRole:"tick",encodeEntry:function(e){var t=e.config,n=e.markDef,s=e.width,u=e.height,l=n.orient,c="horizontal"===l?"width":"height",f="horizontal"===l?"height":"width";return i.__assign({},a.pointPosition("x",e,o.midX(s,t),"xc"),a.pointPosition("y",e,o.midY(u,t),"yc"),a.nonPosition("size",e,{defaultValue:r(e),vgChannel:c}),(d={},d[f]={value:t.tick.thickness},d),a.color(e),a.nonPosition("opacity",e));var d}}},{"./mixins":50,"./valueref":56,tslib:10}],56:[function(e,t,n){"use strict";function r(e,t,n,r,i,a){return t&&i&&e===i.fieldChannel?o(t,n,{suffix:"end"}):l(e,t,n,r,a)}function i(e,t,n,r,i,a,s){return t&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?o(t,r,{suffix:"start"}):l(e,n,r,i,s)}function a(e,t,n,r){return o(e,t,{binSuffix:n},r)}function o(e,t,n,r){var i={scale:t,field:y.field(e,n)};return r&&(i.offset=r),i}function s(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function u(e,t){return{signal:'(scale("'+t+'", '+y.field(e,{binSuffix:"start",expr:"datum"})+') + scale("'+t+'", '+y.field(e,{binSuffix:"end",expr:"datum"})+"))/2"}}function l(e,t,n,r,i){if(t){if(y.isFieldDef(t))return b.isBinScale(r.type)?_.contains(["x","y"],e)?u(t,n):o(t,n,{binSuffix:"start"}):b.hasDiscreteDomain(r.type)?"band"===r.type?o(t,n,{binSuffix:"range"},s(n,.5)):o(t,n,{binSuffix:"range"}):o(t,n,{});if(void 0!==t.value)return{value:t.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===i){if(e===v.X||e===v.X2)return p(n,r);if(e===v.Y||e===v.Y2)return h(n,r);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===i){if(e===v.X||e===v.X2)return m(n,r);if(e===v.Y||e===v.Y2)return g(n,r);throw new Error("Unsupported channel "+e+" for base function")}return i}function c(e,t){if(e){if(y.isFieldDef(e))return S.formatSignalRef(e,e.format,"datum",t);if(e.value)return{value:e.value}}return{value:t.text.text}}function f(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function d(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function p(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{value:0}}function m(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{field:{group:"width"}}}function h(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{field:{group:"height"}}}function g(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{value:0}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("../../channel"),y=e("../../fielddef"),b=e("../../scale"),_=e("../../util"),S=e("../common");n.stackable=r,n.stackable2=i,n.bin=a,n.fieldRef=o,n.band=s,n.midPoint=l,n.text=c,n.midX=f,n.midY=d},{"../../channel":16,"../../fielddef":87,"../../scale":93,"../../util":102,"../common":20}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../channel"),a=e("../encoding"),o=e("../fielddef"),s=e("../util"),u=e("./layout/header"),l=e("./scale/assemble"),c=e("./unit"),f=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e];)e=this.nameMap[e];return e},e}();n.NameMap=f;var d=function(){function e(e,t,n,r){var i=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=i.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=i.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.name=e.name||n,this.scaleNameMap=t?t.scaleNameMap:new f,this.sizeNameMap=t?t.sizeNameMap:new f,this.data=e.data,this.description=e.description,this.transforms=e.transform||[],this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{}},mark:null,scales:null,axes:{x:null,y:null},layoutHeaders:{row:{},column:{}},legends:null,selection:null}}return e.prototype.parse=function(){this.parseData(),this.parseScale(),this.parseSelection(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMark()},e.prototype.assembleScales=function(){return l.assembleScale(this)},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,r=u.HEADER_CHANNELS;n<r.length;n++){var i=r[n];e[i].title&&t.push(u.getTitleGroup(this,i))}for(var a=0,o=u.HEADER_CHANNELS;a<o.length;a++)for(var i=o[a],s=e[i],l=0,c=u.HEADER_TYPES;l<c.length;l++){var f=c[l];if(s[f])for(var d=0,p=s[f];d<p.length;d++){var m=p[d],h=u.getHeaderGroup(this,i,f,s,m);h&&t.push(h)}}return t},e.prototype.assembleAxes=function(){var e=this.component.axes,t=e.x,n=e.y;return(t?t.axes.concat(t.gridAxes):[]).concat(n?n.axes.concat(n.gridAxes):[])},e.prototype.assembleLegends=function(){return s.vals(this.component.legends)},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};e=e.concat(this.assembleSelectionSignals()),e.length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=this.assembleScales();r.length>0&&(t.scales=r);var i=this.assembleAxes();i.length>0&&(t.axes=i);var a=this.assembleLegends();return a.length>0&&(t.legends=a),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(r instanceof c.UnitModel){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return s.varName((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e);return this.lookupDataSource(t)},e.prototype.getSizeSignalRef=function(e){return{signal:this.getName(e)}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.source:e},e.prototype.renameSize=function(e,t){this.sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===i.X||e===i.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this.sizeNameMap.get(this.getName(e))},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scale=function(e){return null},e.prototype.scaleName=function(e,t){return t?this.getName(e):this.scale&&i.isChannel(e)&&this.scale(e)||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.getComponent=function(e,t){return this.component[e][t]||this.parent.getComponent(e,t)},e}();n.Model=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=s.extend({binSuffix:this.hasDiscreteDomain(e)?"range":"start"},t)),o.field(n,t)},t.prototype.reduceFieldDef=function(e,t,n){return a.reduce(this.getMapping(),function(t,n,r){return o.isFieldDef(n)?e(t,n,r):t},t,n)},t.prototype.forEachFieldDef=function(e,t){a.forEach(this.getMapping(),function(t,n){o.isFieldDef(t)&&e(t,n)},t)},t}(d);n.ModelWithField=p},{"../channel":16,"../encoding":85,"../fielddef":87,"../util":102,"./layout/header":40,"./scale/assemble":59,"./unit":78,tslib:10}],58:[function(e,t,n){"use strict";function r(e,t){return o(e,t)}function i(e,t){return o(e,t)}function a(e,t){var n=e.field;return c.isRepeatRef(n)?n.repeat in t?s.__assign({},e,{field:t[n.repeat]}):(f.warn(f.message.noSuchRepeatedValue(n.repeat)),null):e}function o(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(u.isArray(i))n[r]=i.map(function(e){return a(e,t)}).filter(function(e){return null!==e});else{var o=a(i,t);null!==o&&(n[r]=o)}}return n}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),u=e("vega-util"),l=e("../channel"),c=e("../fielddef"),f=e("../log"),d=e("../util"),p=e("../vega.schema"),m=e("./common"),h=e("./data/assemble"),g=e("./data/parse"),v=e("./model"),y=e("./scale/domain");n.replaceRepeaterInFacet=r,n.replaceRepeaterInEncoding=i;var b=function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,a)||this;return o.repeat=t.repeat,o.children=o._initChildren(t,o.repeat,i,a),o}return s.__extends(t,e),t.prototype._initChildren=function(e,t,n,r){for(var i=[],a=t.row||[n?n.row:null],o=t.column||[n?n.column:null],s=0,u=a;s<u.length;s++)for(var l=u[s],c=0,f=o;c<f.length;c++){var d=f[c],p=(l?"_"+l:"")+(d?"_"+d:""),h={row:l,column:d};i.push(m.buildModel(e.spec,this,this.getName("child"+p),void 0,h,r))}return i},t.prototype.parseData=function(){this.component.data=g.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++){var r=n[t];!function(t){t.parseSelection(),d.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(r)}},t.prototype.parseScale=function(){var e=this,t=this.component.scales={};this.children.forEach(function(n){n.parseScale(),d.keys(n.component.scales).forEach(function(r){if(d.contains(l.NONSPATIAL_SCALE_CHANNELS,r)){var i=n.component.scales[r],a=t[r];if(!i||p.isSignalRefDomain(i.domain)||a&&p.isSignalRefDomain(a.domain))return;a?a.domain=y.unionDomains(a.domain,i.domain):t[r]=i;var o=i.name.substr(n.getName("").length),s=e.scaleName(o,!0)
;n.renameScale(i.name,s),i.name=s,delete n.component.scales[r]}})})},t.prototype.parseMark=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMark()}},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseLegend=function(){for(var e=this.component.legends={},t=0,n=this.children;t<n.length;t++){var r=n[t];!function(t){t.parseLegend(),d.keys(t.component.legends).forEach(function(n){e[n]||(e[n]=t.component.legends[n]),delete t.component.legends[n]})}(r)}},t.prototype.assembleData=function(){return this.parent?[]:h.assembleData(d.vals(this.component.data.sources))},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},[])},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleScales=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleScales())},e.prototype.assembleScales.call(this))},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleParentGroupProperties();return s.__assign({type:"group",name:e.getName("group")},t?{encode:{update:t}}:{},e.assembleGroup())})},t}(v.Model);n.RepeatModel=b},{"../channel":16,"../fielddef":87,"../log":90,"../util":102,"../vega.schema":104,"./common":20,"./data/assemble":24,"./data/parse":32,"./model":57,"./scale/domain":60,tslib:10,"vega-util":106}],59:[function(e,t,n){"use strict";function r(e){return s.vals(e.component.scales).map(function(t){var n=t.domainRaw;if(n&&n.selection){n.field=n.field||null,n.encoding=n.encoding||null;var r=n.selection,c=e.component.selection&&e.component.selection[r];c?o.warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.'):(c=e.getComponent("selection",r),t.domainRaw={signal:("interval"===c.type?"vlIntervalDomain":"vlPointDomain")+"("+s.stringValue(c.name+"_store")+", "+s.stringValue(n.encoding)+", "+s.stringValue(n.field)+", "+s.stringValue(l[c.resolve])+")"})}var f=t.domain;if(u.isDataRefDomain(f)||u.isFieldRefUnionDomain(f))return f.data=e.lookupDataSource(f.data),t;if(u.isDataRefUnionedDomain(f))return f.fields=f.fields.map(function(t){return i.__assign({},t,{data:e.lookupDataSource(t.data)})}),t;if(u.isSignalRefDomain(f)||a.isArray(f))return t;throw new Error("invalid scale domain")})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("vega-util"),o=e("../../log"),s=e("../../util"),u=e("../../vega.schema"),l={global:"union",independent:"intersect",union:"union",union_others:"union",intersect:"intersect",intersect_others:"intersect"};n.assembleScale=r},{"../../log":90,"../../util":102,"../../vega.schema":104,tslib:10,"vega-util":106}],60:[function(e,t,n){"use strict";function r(e,t,n,r){if("unaggregated"===e){var i=s(t,n),a=i.valid,o=i.reason;if(!a)return void c.warn(o)}else if(void 0===e&&r.useUnaggregatedDomain){var a=s(t,n).valid;if(a)return"unaggregated"}return e}function i(e,t){var n=e.scale(t);return"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?l(a(n,e,"x"),a(n,e,"x2")):a(n,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?l(a(n,e,"y"),a(n,e,"y2")):a(n,e,"y2"):a(n,e,t)}function a(e,t,n){var r=t.fieldDef(n);if(e.domain&&"unaggregated"!==e.domain&&!m.isSelectionDomain(e.domain))return p.isDateTime(e.domain[0])?e.domain.map(function(e){return p.timestamp(e,!0)}):e.domain;var i=t.stack;if(i&&n===i.fieldChannel)return"normalize"===i.offset?[0,1]:{data:t.requestDataName(y.MAIN),fields:[t.field(n,{suffix:"start"}),t.field(n,{suffix:"end"})]};var a=o(t,n,e.type);if("unaggregated"===e.domain)return{data:t.requestDataName(y.MAIN),fields:[t.field(n,{aggregate:"min"}),t.field(n,{aggregate:"max"})]};if(r.bin){if(m.isBinScale(e.type)){var s=t.getName(d.binToString(r.bin)+"_"+r.field+"_bins");return{signal:"sequence("+s+".start, "+s+".stop + "+s+".step, "+s+".step)"}}return m.hasDiscreteDomain(e.type)?{data:t.requestDataName(y.MAIN),field:t.field(n,{binSuffix:"range"}),sort:{field:t.field(n,{binSuffix:"start"}),op:"min"}}:"x"===n||"y"===n?{data:t.requestDataName(y.MAIN),fields:[t.field(n,{binSuffix:"start"}),t.field(n,{binSuffix:"end"})]}:{data:t.requestDataName(y.MAIN),field:t.field(n,{binSuffix:"start"})}}return a?{data:g.isBoolean(a)?t.requestDataName(y.MAIN):t.requestDataName(y.RAW),field:t.field(n),sort:a}:{data:t.requestDataName(y.MAIN),field:t.field(n)}}function o(e,t,n){if(m.hasDiscreteDomain(n)){var r=e.sort(t);return h.isSortField(r)?{op:r.op,field:r.field}:!!g.contains(["ascending","descending",void 0],r)||void 0}}function s(e,t){return e.aggregate?f.SHARED_DOMAIN_OP_INDEX[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:c.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:c.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:c.message.unaggregateDomainHasNoEffectForRawField(e)}}function u(e){if(g.isArray(e))return[e];if(v.isDataRefDomain(e))return delete e.sort,[e];if(v.isFieldRefUnionDomain(e))return e.fields.map(function(t){return{data:e.data,field:t}});if(v.isDataRefUnionedDomain(e))return e.fields.map(function(e){return g.isArray(e)?e:{data:e.data,field:e.field}});throw new Error(c.message.INVAID_DOMAIN)}function l(e,t){if(v.isSignalRefDomain(e)||v.isSignalRefDomain(t)){if(!v.isSignalRefDomain(e)||!v.isSignalRefDomain(t)||e.signal!==t.signal)throw new Error(c.message.UNABLE_TO_MERGE_DOMAINS);return e}var n=u(e),r=u(t),i=n.concat(r);if(i=g.unique(i,g.hash),i.length>1){var a=i.map(function(e){return v.isDataRefDomain(e)?e.data:null});return 1===g.unique(a,function(e){return e}).length&&null!==a[0]?{data:a[0],fields:i.map(function(e){return e.field})}:{fields:i,sort:!0}}return i[0]}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../log"),f=e("../../aggregate"),d=e("../../bin"),p=e("../../datetime"),m=e("../../scale"),h=e("../../sort"),g=e("../../util"),v=e("../../vega.schema"),y=e("../../data");n.initDomain=r,n.parseDomain=i,n.domainSort=o,n.canUseUnaggregatedDomain=s,n.unionDomains=l},{"../../aggregate":13,"../../bin":15,"../../data":83,"../../datetime":84,"../../log":90,"../../scale":93,"../../sort":95,"../../util":102,"../../vega.schema":104}],61:[function(e,t,n){"use strict";function r(e,t,r,a,l,f){var p=(t||{}).scale||{},m={type:d.default(p.type,e,t,a,void 0!==l,p.rangeStep,r.scale)};return n.NON_TYPE_RANGE_SCALE_PROPERTIES.forEach(function(n){var a=p[n],u=s.scaleTypeSupportProperty(m.type,n),l=s.channelScalePropertyIncompatability(e,n);if(void 0!==a&&(u?l&&o.warn(l):o.warn(o.message.scalePropertyNotWorkWithScaleType(m.type,n,e))),u&&void 0===l){var c=i(a,n,m,e,t,r.scale);void 0!==c&&(m[n]=c)}}),u.extend(m,c.default(e,m.type,t.type,p,r,m.zero,a,l,f))}function i(e,t,n,r,i,o){return"domain"===t?l.initDomain(e,i,n.type,o):void 0!==e?e:a(t,n,r,i,o)}function a(e,t,n,r,i){switch(e){case"nice":return f.nice(t.type,n,r);case"padding":return f.padding(n,t.type,i);case"paddingInner":return f.paddingInner(t.padding,n,i);case"paddingOuter":return f.paddingOuter(t.padding,n,t.type,t.paddingInner,i);case"round":return f.round(n,i);case"zero":return f.zero(t,n,r)}return i[e]}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../log"),s=e("../../scale"),u=e("../../util"),l=e("./domain"),c=e("./range"),f=e("./rules"),d=e("./type");n.NON_TYPE_RANGE_SCALE_PROPERTIES=["domain","round","clamp","nice","exponent","zero","interpolate","padding","paddingInner","paddingOuter"],n.default=r},{"../../log":90,"../../scale":93,"../../util":102,"./domain":60,"./range":63,"./rules":64,"./type":65}],62:[function(e,t,n){"use strict";function r(e){return e.channels().reduce(function(t,n){var r=i(e,n);return r&&(t[n]=r),t},{})}function i(e,t){if(!e.scale(t))return null;var r=e.scale(t),i=e.sort(t),l={name:e.scaleName(t+"",!0),type:r.type,domain:s.parseDomain(e,t),range:u.parseRange(r)};return a.isSelectionDomain(r.domain)&&(l.domainRaw=r.domain),n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES.forEach(function(e){l[e]=r[e]}),i&&"descending"===(o.isSortField(i)?i.order:i)&&(l.reverse=!0),l}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../scale"),o=e("../../sort"),s=e("./domain"),u=e("./range");n.default=r,n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=["round","clamp","nice","exponent","interpolate","zero","padding","paddingInner","paddingOuter"],n.parseScale=i},{"../../scale":93,"../../sort":95,"./domain":60,"./range":63}],63:[function(e,t,n){"use strict";function r(e){if(e.rangeStep)return{step:e.rangeStep};if(e.scheme){var t=e.scheme;if(f.isExtendedScheme(t)){var n={scheme:t.name};return t.count&&(n.count=t.count),t.extent&&(n.extent=t.extent),n}return{scheme:t}}return e.range}function i(e,t,r,i,u,p,m,h,g){for(var v=!1,y=0,b=n.RANGE_PROPERTIES;y<b.length;y++){var _=b[y];if(void 0!==i[_]){var S=f.scaleTypeSupportProperty(t,_),E=f.channelScalePropertyIncompatability(e,_);if(S)if(E)l.warn(E);else switch(_){case"range":return{range:i[_]};case"scheme":return{scheme:i[_]};case"rangeStep":if(void 0===h){var x=i[_];if(null!==x)return{rangeStep:x};v=!0}else l.warn(l.message.rangeStepDropped(e))}else l.warn(l.message.scalePropertyNotWorkWithScaleType(t,_,e))}}switch(e){case c.ROW:return{range:"height"};case c.COLUMN:return{range:"width"};case c.X:case c.Y:if(void 0===h){if(d.contains(["point","band"],t)&&!v)if(e===c.X&&"text"===m){if(u.scale.textXRangeStep)return{rangeStep:u.scale.textXRangeStep}}else if(u.scale.rangeStep)return{rangeStep:u.scale.rangeStep};h=e===c.X?u.cell.width:u.cell.height}return{range:e===c.X?[0,h]:[h,0]};case c.SIZE:return{range:[o(m,p,u),s(m,g,u)]};case c.SHAPE:case c.COLOR:return{range:a(e,t,r,m)};case c.OPACITY:return{range:[u.scale.minOpacity,u.scale.maxOpacity]}}throw new Error("Scale range undefined for channel "+e)}function a(e,t,n,r){switch(e){case c.SHAPE:return"symbol";case c.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===r?"heatmap":"ramp"}}function o(e,t,n){if(t)return 0;switch(e){case"bar":return void 0!==n.scale.minBandSize?n.scale.minBandSize:n.bar.continuousBandSize;case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":if(n.scale.minSize)return n.scale.minSize}throw new Error(l.message.incompatibleChannel("size",e))}function s(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:u(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=u(t,r);return(i-2)*(i-2)}throw new Error(l.message.incompatibleChannel("size",e))}function u(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../log"),c=e("../../channel"),f=e("../../scale"),d=e("../../util");n.parseRange=r,n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.default=i},{"../../channel":16,"../../log":90,"../../scale":93,"../../util":102}],64:[function(e,t,n){"use strict";function r(e,t,n){return d.contains([c.ScaleType.TIME,c.ScaleType.UTC],e)?f.smallestUnit(n.timeUnit):d.contains([l.X,l.Y],t)}function i(e,t,n){if(d.contains([l.X,l.Y],e)&&t===c.ScaleType.POINT)return n.pointPadding}function a(e,t,n){if(void 0===e)return d.contains([l.X,l.Y],t)?n.bandPaddingInner:void 0}function o(e,t,n,r,i){if(void 0===e)return d.contains([l.X,l.Y],t)&&n===c.ScaleType.BAND?void 0!==i.bandPaddingOuter?i.bandPaddingOuter:r/2:void 0}function s(e,t){if(d.contains(["x","y","row","column"],e))return t.round}function u(e,t,n){return"size"===t&&"quantitative"===n.type||!(e.domain||n.bin||!d.contains([l.X,l.Y],t))}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),c=e("../../scale"),f=e("../../timeunit"),d=e("../../util");n.nice=r,n.padding=i,n.paddingInner=a,n.paddingOuter=o,n.round=s,n.zero=u},{"../../channel":16,"../../scale":93,"../../timeunit":98,"../../util":102}],65:[function(e,t,n){"use strict";function r(e,t,n,r,a,o,c){var f=i(t,n,r,a,o,c);return l.hasScale(t)?void 0!==e?l.supportScaleType(t,e)?s(e,n)?e:(u.warn(u.message.scaleTypeNotWorkWithFieldDef(e,f)),f):(u.warn(u.message.scaleTypeNotWorkWithChannel(t,e,f)),f):f:null}function i(e,t,n,r,i,o){if(m.contains(["row","column"],e))return"band";switch(t.type){case"nominal":return"color"===e||"discrete"===l.rangeType(e)?"ordinal":a(e,n,r,i,o);case"ordinal":return"color"===e?"ordinal":"discrete"===l.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):a(e,n,r,i,o);case"temporal":return"color"===e?"sequential":"discrete"===l.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):f.isDiscreteByDefault(t.timeUnit)?a(e,n,r,i,o):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===l.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin?"bin-linear":"linear"}throw new Error(u.message.invalidFieldType(t.type))}function a(e,t,n,r,i){if(m.contains(["x","y"],e)){if("rect"===t)return"band";if("bar"===t)return o(n,r,i)?"point":"band"}return"point"}function o(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}function s(e,t){var n=t.type;return h.contains([p.Type.ORDINAL,p.Type.NOMINAL],n)?void 0===e||d.hasDiscreteDomain(e):n===p.Type.TEMPORAL?t.timeUnit?h.contains([c.ScaleType.TIME,c.ScaleType.UTC,void 0],e)||d.hasDiscreteDomain(e):h.contains([c.ScaleType.TIME,c.ScaleType.UTC,void 0],e):n!==p.Type.QUANTITATIVE||(t.bin?e===c.ScaleType.BIN_LINEAR||e===c.ScaleType.BIN_ORDINAL:h.contains([c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.LINEAR,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../log"),l=e("../../channel"),c=e("../../scale"),f=e("../../timeunit"),d=e("../../scale"),p=e("../../type"),m=e("../../util"),h=e("../../util");n.default=r,n.fieldDefMatchScaleType=s},{"../../channel":16,"../../log":90,"../../scale":93,"../../timeunit":98,"../../type":101,"../../util":102}],66:[function(e,t,n){"use strict";function r(e){var t=null,n=null,r=null,i=null;return e.project.forEach(function(e,a){e.encoding===s.X?(t=e,n=a):e.encoding===s.Y&&(r=e,i=a)}),{x:t,xi:n,y:r,yi:i}}function i(e,t,n){var r=c.channelSignalName(t,n),i=e.getSizeSignalRef(n===s.X?"width":"height").signal,o=n+"(unit)",u=c.invert.bind(null,e,t,n);return{name:r,value:[],on:f.default.has(t)?[]:a(t,function(e,t){return e.push({events:t.between[0],update:u("["+o+", "+o+"]")}),e.push({events:t,update:"["+r+"[0], "+u("clamp("+o+", 0, "+i+")")+"]"}),e})}}function a(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(u.warn(n+" is not an ordered event stream for interval selections"),e)},[])}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../channel"),u=e("../../log"),l=e("../../util"),c=e("./selection"),f=e("./transforms/scales");n.BRUSH="_brush",n.SIZE="_size";var d={predicate:"vlInterval",signals:function(e,t){var r=[],o=[],c=t.name,d=c+n.SIZE;return t.translate&&!f.default.has(t)&&a(t,function(e,t){(t.between[0].filter||(t.between[0].filter=[])).push("!event.item || (event.item && event.item.mark.name !== "+l.stringValue(c+n.BRUSH)+")")}),t.project.forEach(function(n){if(n.encoding!==s.X&&n.encoding!==s.Y)return void u.warn("Interval selections only support x and y encoding channels.");var a=i(e,t,n.encoding);r.push(a),o.push("{encoding: "+l.stringValue(n.encoding)+", field: "+l.stringValue(n.field)+", extent: "+a.name+"}")}),r.push({name:d,value:[],on:a(t,function(e,t){return e.push({events:t.between[0],update:"{x: x(unit), y: y(unit), width: 0, height: 0}"}),e.push({events:t,update:"{x: "+d+".x, y: "+d+".y, width: abs(x(unit) - "+d+".x), height: abs(y(unit) - "+d+".y)}"}),e})},{name:c,update:"["+o.join(", ")+"]"}),r},tupleExpr:function(e,t){return"intervals: "+t.name},modifyExpr:function(e,t){var n=t.name+c.TUPLE;return n+", "+("global"===t.resolve?"true":"{unit: "+n+".unit}")},marks:function(e,t,i){var a=t.name,u=r(t),d=u.xi,p=u.yi,m=a+c.TUPLE,h="data("+l.stringValue(t.name+c.STORE)+")";if(f.default.has(t))return i;var g={x:l.extend({},null!==d?{scale:e.scaleName(s.X),signal:a+"["+d+"].extent[0]"}:{value:0}),x2:l.extend({},null!==d?{scale:e.scaleName(s.X),signal:a+"["+d+"].extent[1]"}:{field:{group:"width"}}),y:l.extend({},null!==p?{scale:e.scaleName(s.Y),signal:a+"["+p+"].extent[0]"}:{value:0}),y2:l.extend({},null!==p?{scale:e.scaleName(s.Y),signal:a+"["+p+"].extent[1]"}:{field:{group:"height"}})};return"global"===t.resolve&&l.keys(g).forEach(function(e){g[e]=[o.__assign({test:h+".length && "+m+" && "+m+".unit === "+h+"[0].unit"},g[e]),{value:0}]}),[{name:void 0,type:"rect",encode:{enter:{fill:{value:"#eee"}},update:g}}].concat(i,{name:a+n.BRUSH,type:"rect",encode:{enter:{fill:{value:"transparent"}},update:g}})}};n.default=d,n.projections=r},{"../../channel":16,"../../log":90,"../../util":102,"./selection":68,"./transforms/scales":73,tslib:10}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./selection"),a={predicate:"vlPoint",signals:function(e,t){var n=t.project,i=n.map(function(e){return r.stringValue(e.encoding)}).join(", "),a=n.map(function(e){return r.stringValue(e.field)}).join(", "),o=n.map(function(e){return"(item().isVoronoi ? datum.datum : datum)["+r.stringValue(e.field)+"]"}).join(", ");return[{name:t.name,value:{},on:[{events:t.events,update:"{encodings: ["+i+"], fields: ["+a+"], values: ["+o+"]}"}]}]},tupleExpr:function(e,t){var n=t.name;return"encodings: "+n+".encodings, fields: "+n+".fields, values: "+n+".values"},modifyExpr:function(e,t){var n=t.name+i.TUPLE;return n+", "+("global"===t.resolve?"null":"{unit: "+n+".unit}")}};n.default=a},{"../../util":102,"./selection":68}],68:[function(e,t,n){"use strict";function r(e,t){var n={},r=e.config.selection;for(var i in t)!function(i){if(!t.hasOwnProperty(i))return"continue";var a=t[i],o=r[a.type];for(var s in o)"encodings"===s&&a.fields||"fields"===s&&a.encodings||void 0!==a[s]&&!0!==a[s]||(a[s]=o[s]||a[s]);var u=n[i]=g.extend({},a,{name:i,events:g.isString(a.on)?h.selector(a.on,"scope"):a.on,domain:"data"});S.forEachTransform(u,function(t){t.parse&&t.parse(e,a,u)})}(i);return n}function i(e,t){return c(e,function(r,i){var a=r.name,o=i.tupleExpr(e,r),s=i.modifyExpr(e,r);t.push.apply(t,i.signals(e,r)),S.forEachTransform(r,function(n){n.signals&&(t=n.signals(e,r,t)),n.modifyExpr&&(s=n.modifyExpr(e,r,s))}),t.push({name:a+n.TUPLE,on:[{events:{signal:a},update:"{unit: unit.datum && unit.datum._id, "+o+"}"}]},{name:a+n.MODIFY,on:[{events:{signal:a},update:"modify("+g.stringValue(r.name+n.STORE)+", "+s+")"}]})}),t}function a(e,t){return t.filter(function(e){return"unit"===e.name}).length||t.push({name:"unit",value:{},on:[{events:"mousemove",update:"group()._id ? group() : unit"}]}),c(e,function(n,r){r.topLevelSignals&&t.push.apply(t,r.topLevelSignals(e,n)),S.forEachTransform(n,function(r){r.topLevelSignals&&(t=r.topLevelSignals(e,n,t))})}),t}function o(e,t){return c(e,function(e){t.filter(function(t){return t.name===e.name+n.STORE}).length||t.push({name:e.name+n.STORE})}),t}function s(e,t){var n=!1,r=t;return c(e,function(i,a){r=a.marks?a.marks(e,i,r):r,S.forEachTransform(i,function(a){n=n||a.clipGroup,a.marks&&(r=a.marks(e,i,t,r))})}),e.parent&&e.parent instanceof v.LayerModel?[r,m]:n?m(r):r}function u(e,t){var n=!1;return e.children.forEach(function(e){var r=s(e,t);t=r[0],n=n||r[1]}),n?m(t):t}function l(e,t,r,i,a){var o=g.stringValue(e+n.STORE),s=E[r||"global"];return i=i||"datum",a=null===a?null:"parent._id",f(t).predicate+"("+o+", "+a+", "+i+", "+s+")"}function c(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,f(i.type))}}function f(e){switch(e){case"single":return _.default;case"multi":return b.default;case"interval":return y.default}return null}function d(e,t,n,r){var i=g.stringValue(e.scaleName(n));return"data"===t.domain?"invert("+i+", "+r+")":r}function p(e,t){return e.name+"_"+e.fields[t]}function m(e){return e.map(function(e){return e.clip=!0,e})}Object.defineProperty(n,"__esModule",{value:!0});var h=e("vega-event-selector"),g=e("../../util"),v=e("../layer"),y=e("./interval"),b=e("./multi"),_=e("./single"),S=e("./transforms/transforms");n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.parseUnitSelection=r,n.assembleUnitSelectionSignals=i,n.assembleTopLevelSignals=a,n.assembleUnitSelectionData=o,n.assembleUnitSelectionMarks=s,n.assembleLayerSelectionMarks=u;var E={global:'"union", "all"',independent:'"intersect", "unit"',union:'"union", "all"',union_others:'"union", "others"',intersect:'"intersect", "all"',intersect_others:'"intersect", "others"'};n.predicate=l,n.invert=d,n.channelSignalName=p},{"../../util":102,"../layer":39,"./interval":66,"./multi":67,"./single":69,"./transforms/transforms":75,"vega-event-selector":11}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./multi"),a=e("./selection"),o={predicate:i.default.predicate,signals:i.default.signals,topLevelSignals:function(e,t){return[{name:t.name,update:"data("+r.stringValue(t.name+a.STORE)+")[0]"}]},tupleExpr:function(e,t){var n=t.name,r=n+".values";return"encodings: "+n+".encodings, fields: "+n+".fields, values: "+r+", "+t.project.map(function(e,t){return e.field+": "+r+"["+t+"]"}).join(", ")},modifyExpr:function(e,t){var n=t.name+a.TUPLE;return n+", "+("global"===t.resolve?"true":"{unit: "+n+".unit}")}};n.default=o},{"../../util":102,"./multi":67,"./selection":68}],70:[function(e,t,n){"use strict";function r(e){return"_"+e.replace(/\W/g,"_")}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../util"),a={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var a=t.name,o=t.project,s=t.bind;return o.forEach(function(e){n.unshift({name:a+r(e.field),value:"",on:[{events:t.events,update:"(item().isVoronoi ? datum.datum : datum)["+i.stringValue(e.field)+"]"}],bind:s[e.field]||s[e.encoding]||s})}),n},signals:function(e,t,n){var a=t.name,o=t.project,s=n.filter(function(e){return e.name===a})[0],u=o.map(function(e){return i.stringValue(e.field)}).join(", "),l=o.map(function(e){return a+r(e.field)}).join(", ");return s.update="{fields: ["+u+"], values: ["+l+"]}",delete s.value,delete s.on,n}};n.default=a},{"../../../util":102}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={has:function(e){return void 0!==e.nearest&&!1!==e.nearest},marks:function(e,t,n,r){var i=n[0],a=r.indexOf(i),o=i.name===e.getName("pathgroup"),s=function(e){return e.name&&e.name.indexOf("voronoi")>=0},u={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:"datum.x",y:"datum.y",size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};return o&&!i.marks.filter(s).length?(i.marks.push(u),r.splice(a,1,i)):o||r.filter(s).length||r.splice(a+1,0,u),r}};n.default=r},{}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={has:function(e){return void 0!==e.fields||void 0!==e.encodings},parse:function(e,t,n){var r={};(t.fields||[]).forEach(function(e){return r[e]=null}),(t.encodings||[]).forEach(function(t){return r[e.fieldDef(t).field]=t});var i=n.project||(n.project=[]);for(var a in r)r.hasOwnProperty(a)&&i.push({field:a,encoding:r[a]});r=n.fields||(n.fields={}),i.filter(function(e){return e.encoding}).forEach(function(e){return r[e.encoding]=e.field})}};n.default=r},{}],73:[function(e,t,n){"use strict";function r(e,t){return"domain("+o.stringValue(e.scaleName(t))+")"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../log"),a=e("../../../scale"),o=e("../../../util"),s=e("../interval"),u=e("../selection"),l={clipGroup:!0,has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var r=n.scales=[];n.project.forEach(function(t){var o=t.encoding,s=e.getComponent("scales",o);if(!s||!a.hasContinuousDomain(s.type))return void i.warn("Scale bindings are currently only supported for scales with continuous domains.");s.domainRaw={signal:u.channelSignalName(n,o)},r.push(o)})},topLevelSignals:function(e,t,n){var r=t.scales.filter(function(e){return!n.filter(function(n){return n.name===u.channelSignalName(t,e)}).length});return n.concat(r.map(function(e){return{name:u.channelSignalName(t,e)}}))},signals:function(e,t,n){var r=t.name;return n=n.filter(function(e){return e.name!==r+s.SIZE&&e.name!==r+u.TUPLE&&e.name!==u.MODIFY}),t.scales.forEach(function(e){var r=n.filter(function(n){return n.name===u.channelSignalName(t,e)})[0];r.push="outer",delete r.value,delete r.update}),n}};n.default=l,n.domain=r},{"../../../log":90,"../../../scale":93,"../../../util":102,"../interval":66,"../selection":68}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../selection"),i={has:function(e){return void 0!==e.toggle&&!1!==e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var i=t.name+r.TUPLE,a=t.name+"_toggle";return a+" ? null : "+i+", "+("global"===t.resolve?a+" ? null : true, ":a+" ? null : {unit: "+i+".unit}, ")+a+" ? "+i+" : null"}};n.default=i},{"../selection":68}],75:[function(e,t,n){"use strict";function r(e,t){for(var n in f)f[n].has(e)&&t(f[n])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./inputs"),a=e("./nearest"),o=e("./project"),s=e("./scales"),u=e("./toggle"),l=e("./translate"),c=e("./zoom"),f={project:o.default,toggle:u.default,scales:s.default,translate:l.default,zoom:c.default,inputs:i.default,nearest:a.default};n.forEachTransform=r},{"./inputs":70,"./nearest":71,"./project":72,"./scales":73,"./toggle":74,"./translate":76,"./zoom":77}],76:[function(e,t,n){"use strict";function r(e,t){var n=t===o.X?"+":"-";return c.default.has(e)&&(n="+"===n?"-":"+"),n}function i(e,t,n,i,a){var u=t.name,p=a.filter(function(e){return e.name===l.channelSignalName(t,n)})[0],m=u+f,h=u+d,g=s.stringValue(e.scaleName(n)),v=".extent_"+n,y=r(t,n),b=y+" abs(span("+m+v+")) * "+h+"."+n+" / "+m+"."+i,_="["+m+v+"[0] "+b+", "+m+v+"[1] "+b+"]",S="invert("+g+(n===o.X?", 0":", unit."+i)+")",E="invert("+g+(n===o.X?", unit."+i:", 0")+")";p.on.push({events:{signal:h},update:c.default.has(t)?_:"clampRange("+_+", "+S+", "+E+")"})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-event-selector"),o=e("../../../channel"),s=e("../../../util"),u=e("../interval"),l=e("../selection"),c=e("./scales"),f="_translate_anchor",d="_translate_delta",p={has:function(e){return"interval"===e.type&&void 0!==e.translate&&!1!==e.translate},signals:function(e,t,n){var r=t.name,s=c.default.has(t),l=s?"unit":r+u.SIZE,p=r+f,m=u.projections(t),h=m.x,g=m.y,v=a.selector(t.translate,"scope");return s||(v=v.map(function(e){return e.between[0].markname=r+u.BRUSH,e})),n.push({name:p,value:{},on:[{events:v.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit), width: "+l+".width, height: "+l+".height, "+(null!==h?"extent_x: "+(s?c.domain(e,o.X):"slice("+r+"_"+h.field+")")+", ":"")+(null!==g?"extent_y: "+(s?c.domain(e,o.Y):"slice("+r+"_"+g.field+")")+", ":"")+"}"}]},{name:r+d,value:{},on:[{events:v,update:"{x: x(unit) - "+p+".x, y: y(unit) - "+p+".y}"}]}),null!==h&&i(e,t,o.X,"width",n),null!==g&&i(e,t,o.Y,"height",n),n}};n.default=p},{"../../../channel":16,"../../../util":102,"../interval":66,"../selection":68,"./scales":73,"vega-event-selector":11}],77:[function(e,t,n){"use strict";function r(e,t,n,r,i){var s=t.name,d=i.filter(function(e){return e.name===u.channelSignalName(t,n)})[0],p=l.default.has(t),m=p?l.domain(e,n):d.name,h=""+s+c+"."+n,g=s+f,v=o.stringValue(e.scaleName(n)),y="["+h+" + ("+m+"[0] - "+h+") * "+g+", "+h+" + ("+m+"[1] - "+h+") * "+g+"]",b="invert("+v+(n===a.X?", 0":", unit."+r)+")",_="invert("+v+(n===a.X?", unit."+r:", 0")+")";d.on.push({events:{signal:g},update:p?y:"clampRange("+y+", "+b+", "+_+")"})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-event-selector"),a=e("../../../channel"),o=e("../../../util"),s=e("../interval"),u=e("../selection"),l=e("./scales"),c="_zoom_anchor",f="_zoom_delta",d={has:function(e){return"interval"===e.type&&void 0!==e.zoom&&!1!==e.zoom},signals:function(e,t,n){var u=t.name,d=u+f,p=s.projections(t),m=p.x,h=p.y,g=o.stringValue(e.scaleName(a.X)),v=o.stringValue(e.scaleName(a.Y)),y=i.selector(t.zoom,"scope");l.default.has(t)||(y=y.map(function(e){return e.markname=u+s.BRUSH,e})),n.push({name:u+c,on:[{events:y,update:"{x: invert("+g+", x(unit)), y: invert("+v+", y(unit))}"}]},{name:d,on:[{events:y,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==m&&r(e,t,"x","width",n),null!==h&&r(e,t,"y","height",n);var b=n.filter(function(e){return e.name===u+s.SIZE});if(b.length){var _=b[0].name;b[0].on.push({events:{signal:d},update:"{x: "+_+".x, y: "+_+".y, width: "+_+".width * "+d+" , height: "+_+".height * "+d+"}"})}return n}};n.default=d},{"../../../channel":16,"../../../util":102,"../interval":66,"../selection":68,"./scales":73,"vega-event-selector":11}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../channel"),a=e("../encoding"),o=e("../encoding"),s=e("../fielddef"),u=e("../mark"),l=e("../scale"),c=e("../stack"),f=e("../util"),d=e("./axis/parse"),p=e("./common"),m=e("./data/assemble"),h=e("./data/parse"),g=e("./facet"),v=e("./layer"),y=e("./layout/index"),b=e("./legend/parse"),_=e("./mark/init"),S=e("./mark/mark"),E=e("./model"),x=e("./repeat"),O=e("./scale/init"),T=e("./scale/parse"),N=e("./selection/selection"),w=function(e){function t(t,n,r,i,o,s){void 0===i&&(i={});var l=e.call(this,t,n,r,s)||this;l.scales={},l.axes={},l.legends={},l.selection={},l.children=[],l.initFacetCellConfig();var f=t.width||i.width,d=t.height||i.height,p=u.isMarkDef(t.mark)?t.mark.type:t.mark,m=l.encoding=a.normalizeEncoding(x.replaceRepeaterInEncoding(t.encoding||{},o),p);l.stack=c.stack(p,m,l.config.stack),l.scales=l.initScales(p,m,f,d),l.markDef=_.initMarkDef(t.mark,m,l.scales,l.config),l.encoding=_.initEncoding(p,m,l.stack,l.config),l.axes=l.initAxes(m),l.legends=l.initLegend(m),l.selection=t.selection;var h=l.initSize(p,l.scales,f,d),g=h.width,v=void 0===g?l.width:g,y=h.height,b=void 0===y?l.height:y;return l.width=v,l.height=b,l}return r.__extends(t,e),t.prototype.scale=function(e){return this.scales[e]},t.prototype.hasDiscreteDomain=function(e){var t=this.scale(e);return t&&l.hasDiscreteDomain(t.type)},t.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},t.prototype.axis=function(e){return this.axes[e]},t.prototype.legend=function(e){return this.legends[e]},t.prototype.initFacetCellConfig=function(){for(var e=this.config,t=this.parent,n=!1;null!==t;){if(t instanceof g.FacetModel){n=!0;break}t=t.parent}n&&(e.cell=f.extend({},e.cell,e.facet.cell))},t.prototype.initScales=function(e,t,n,r){var a=this,s=[];return i.UNIT_SCALE_CHANNELS.reduce(function(u,l){
if(o.channelHasField(t,l)||l===i.X&&o.channelHasField(t,i.X2)||l===i.Y&&o.channelHasField(t,i.Y2)){var c=u[l]=O.default(l,t[l],a.config,e,l===i.X?n:l===i.Y?r:void 0,s);l!==i.X&&l!==i.Y||c.rangeStep&&s.push(c.rangeStep)}return u},{})},t.prototype.initSize=function(e,t,n,r){var a=this.config.cell,o=this.config.scale;if(void 0===n)if(t[i.X])l.hasDiscreteDomain(t[i.X].type)&&t[i.X].rangeStep||(n=a.width);else if(e===u.TEXT)n=o.textXRangeStep;else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");n=o.rangeStep}if(void 0===r)if(t[i.Y])l.hasDiscreteDomain(t[i.Y].type)&&t[i.Y].rangeStep||(r=a.height);else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");r=o.rangeStep}return{width:n,height:r}},t.prototype.initAxes=function(e){return[i.X,i.Y].reduce(function(t,n){var a=e[n];if(s.isFieldDef(a)||n===i.X&&s.isFieldDef(e.x2)||n===i.Y&&s.isFieldDef(e.y2)){var o=s.isFieldDef(a)?a.axis:null;null!==o&&!1!==o&&(t[n]=r.__assign({},o))}return t},{})},t.prototype.initLegend=function(e){return i.NONSPATIAL_SCALE_CHANNELS.reduce(function(t,n){var i=e[n];if(s.isFieldDef(i)){var a=i.legend;null!==a&&!1!==a&&(t[n]=r.__assign({},a))}return t},{})},t.prototype.parseData=function(){this.component.data=h.parseData(this)},t.prototype.parseSelection=function(){this.component.selection=N.parseUnitSelection(this,this.selection)},t.prototype.parseScale=function(){this.component.scales=T.default(this)},t.prototype.parseMark=function(){this.component.mark=S.parseMark(this)},t.prototype.parseAxisAndHeader=function(){this.component.axes=d.parseAxisComponent(this,[i.X,i.Y])},t.prototype.parseLegend=function(){this.component.legends=b.parseLegendComponent(this)},t.prototype.assembleData=function(){return this.parent?[]:m.assembleData(f.vals(this.component.data.sources))},t.prototype.assembleSelectionTopLevelSignals=function(e){return N.assembleTopLevelSignals(this,e)},t.prototype.assembleSelectionSignals=function(){return N.assembleUnitSelectionSignals(this,[])},t.prototype.assembleSelectionData=function(e){return N.assembleUnitSelectionData(this,e)},t.prototype.assembleLayout=function(){return null},t.prototype.assembleLayoutSignals=function(){return y.assembleLayoutUnitSignals(this)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&this.parent instanceof v.LayerModel||(e=N.assembleUnitSelectionMarks(this,e)),e.map(this.correctDataNames)},t.prototype.assembleParentGroupProperties=function(){return r.__assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},p.applyConfig({},this.config.cell,u.FILL_STROKE_CONFIG.concat(["clip"])))},t.prototype.channels=function(){return i.UNIT_CHANNELS},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,r=f.duplicate(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=f.duplicate(this.config)),t||(n.data=f.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return o.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){return this.encoding[e]||{}},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=f.extend({binSuffix:l.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),s.field(n,t)},t}(E.ModelWithField);n.UnitModel=w},{"../channel":16,"../encoding":85,"../fielddef":87,"../mark":91,"../scale":93,"../stack":97,"../util":102,"./axis/parse":18,"./common":20,"./data/assemble":24,"./data/parse":32,"./facet":38,"./layer":39,"./layout/index":41,"./legend/parse":43,"./mark/init":47,"./mark/mark":49,"./model":57,"./repeat":58,"./scale/init":61,"./scale/parse":62,"./selection/selection":68,tslib:10}],79:[function(e,t,n){"use strict";function r(e,t){var r,o,s,u,l=(e.mark,e.encoding),c=i.__rest(e,["mark","encoding"]),f=(l.x,l.y,i.__rest(l,["x","y"])),d=f.size,p=i.__rest(f,["size"]),m=(p.color,i.__rest(p,["color"])),h=d?{size:d}:{size:{value:t.box.size}};if(l.x&&l.y)if(a.isDiscrete(l.x)&&a.isContinuous(l.y))s="x",u="y",o=l.y,r=l.x;else{if(!a.isDiscrete(l.y)||!a.isContinuous(l.x))throw new Error("Need one continuous and one discrete axis for 2D boxplots");s="y",u="x",o=l.x,r=l.y}else if(l.x&&a.isContinuous(l.x)&&void 0===l.y)u="x",o=l.x;else{if(void 0!==l.x||!l.y||!a.isContinuous(l.y))throw new Error("Need a continuous axis for 1D boxplots");u="y",o=l.y}if(void 0!==o.aggregate&&o.aggregate!==n.BOXPLOT)throw new Error("Continuous axis should not be aggregated");var g={field:o.field,type:o.type},v=i.__assign({aggregate:"min"},g),y=i.__assign({axis:o.axis},v),b=i.__assign({aggregate:"q1"},g),_=i.__assign({aggregate:"median"},g),S=i.__assign({aggregate:"q3"},g),E=i.__assign({aggregate:"max"},g),x=void 0!==r?(O={},O[s]=r,O):{};return i.__assign({},c,{layer:[{mark:{type:"rule",role:"boxWhisker"},encoding:i.__assign({},x,(T={},T[u]=y,T[u+"2"]=b,T),m)},{mark:{type:"rule",role:"boxWhisker"},encoding:i.__assign({},x,(N={},N[u]=S,N[u+"2"]=E,N),m)},{mark:{type:"bar",role:"box"},encoding:i.__assign({},x,(w={},w[u]=b,w[u+"2"]=S,w),p,h)},{mark:{type:"tick",role:"boxMid"},encoding:i.__assign({},x,(A={},A[u]=_,A),f,h,{color:{value:"white"}})}]});var O,T,N,w,A}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("./../fielddef");n.BOXPLOT="box-plot",n.normalizeBoxPlot=r},{"./../fielddef":87,tslib:10}],80:[function(e,t,n){"use strict";function r(e){var t=(e.mark,e.encoding),n=i.__rest(e,["mark","encoding"]),r=(t.size,i.__rest(t,["size"])),a=(t.x2,t.y2,i.__rest(t,["x2","y2"])),o=(a.x,a.y,i.__rest(a,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return i.__assign({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:a},{mark:"tick",encoding:t.x2?i.__assign({x:t.x2,y:t.y},o):i.__assign({x:t.x,y:t.y2},o)}]})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib");n.ERRORBAR="error-bar",n.normalizeErrorBar=r},{tslib:10}],81:[function(e,t,n){"use strict";function r(e,t){l[e]=t}function i(e){delete l[e]}function a(e,t){var n=o.isMarkDef(e.mark)?e.mark.type:e.mark,r=l[n];if(r)return r(e,t);throw new Error("Unregistered composite mark "+n)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./../mark"),s=e("./boxplot"),u=e("./errorbar"),l={};n.add=r,n.remove=i,r(s.BOXPLOT,s.normalizeBoxPlot),r(u.ERRORBAR,u.normalizeErrorBar),n.normalize=a},{"./../mark":91,"./boxplot":79,"./errorbar":80}],82:[function(e,t,n){"use strict";function r(e){return u.mergeDeep(u.duplicate(n.defaultConfig),e)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./legend"),a=e("./mark"),o=e("./scale"),s=e("./selection"),u=e("./util");n.defaultCellConfig={width:200,height:200,fill:"transparent"},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1},n.defaultFacetConfig={cell:n.defaultFacetCellConfig},n.defaultOverlayConfig={line:!1},n.defaultConfig={padding:5,numberFormat:"s",timeFormat:"%b %d, %Y",countTitle:"Number of Records",cell:n.defaultCellConfig,mark:a.defaultMarkConfig,area:{},bar:a.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{},square:{},text:a.defaultTextConfig,tick:a.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{},overlay:n.defaultOverlayConfig,scale:o.defaultScaleConfig,axis:{},axisX:{},axisY:{},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:i.defaultLegendConfig,facet:n.defaultFacetConfig,selection:s.defaultConfig},n.initConfig=r},{"./legend":89,"./mark":91,"./scale":93,"./selection":94,"./util":102}],83:[function(e,t,n){"use strict";function r(e){return!!e.url}function i(e){return!!e.values}function a(e){return!!e.name}Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=r,n.isInlineData=i,n.isNamedData=a,n.MAIN="main",n.RAW="raw"},{}],84:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(c.isNumber(e))return e>4&&l.warn(l.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(l.message.invalidTimeUnit("quarter",e))}function a(e){if(c.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(-1!==r)return r+"";var i=t.substr(0,3),a=n.SHORT_MONTHS.indexOf(i);if(-1!==a)return a+"";throw new Error(l.message.invalidTimeUnit("month",e))}function o(e){if(c.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(-1!==r)return r+"";var i=t.substr(0,3),a=n.SHORT_DAYS.indexOf(i);if(-1!==a)return a+"";throw new Error(l.message.invalidTimeUnit("day",e))}function s(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(c.keys(e).length>1)l.warn(l.message.droppedDay(e)),e=c.duplicate(e),delete e.day;else{n.setFullYear(f);var r=t?o(e.day):e.day;n.setDate(+r+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var s=t?i(e.quarter):e.quarter;n.setMonth(3*+s)}if(void 0!==e.month){var u=t?a(e.month):e.month;n.setMonth(+u)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function u(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&c.keys(e).length>1&&(l.warn(l.message.droppedDay(e)),e=c.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(f):n.push(0),void 0!==e.month){var r=t?a(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var s=t?i(e.quarter):e.quarter;n.push(s+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var u=t?o(e.day):e.day;n.push(u+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./log"),c=e("./util"),f=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=s,n.dateTimeExpr=u},{"./log":90,"./util":102}],85:[function(e,t,n){"use strict";function r(e,t){var n=e&&e[t];return!!n&&(p.isArray(n)?p.some(n,function(e){return!!e.field}):f.isFieldDef(n))}function i(e){return p.some(c.CHANNELS,function(t){if(r(e,t)){var n=e[t];return p.isArray(n)?p.some(n,function(e){return!!e.aggregate}):f.isFieldDef(n)&&!!n.aggregate}return!1})}function a(e,t){return Object.keys(e).reduce(function(n,r){if(!c.supportMark(r,t))return d.warn(d.message.incompatibleChannel(r,t)),n;if("size"===r&&"line"===t){var i=e[r];if(f.isFieldDef(i)&&i.aggregate)return d.warn(d.message.incompatibleChannel(r,t,"when the field is aggregated.")),n}if(p.isArray(e[r]))n[r]=e[r].reduce(function(e,t){return f.isFieldDef(t)||f.isValueDef(t)?e.push(f.normalize(t,r)):d.warn(d.message.emptyFieldDef(t,r)),e},[]);else{var i=e[r];if(!f.isFieldDef(i)&&!f.isValueDef(i))return d.warn(d.message.emptyFieldDef(i,r)),n;n[r]=f.normalize(i,r)}return n},{})}function o(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function s(e){var t=[];return c.CHANNELS.forEach(function(n){if(r(e,n)){var i=e[n];(p.isArray(i)?i:[i]).forEach(function(e){t.push(e)})}}),t}function u(e,t,n){e&&Object.keys(e).forEach(function(r){var i=r;p.isArray(e[i])?e[i].forEach(function(e){t.call(n,e,i)}):t.call(n,e[i],i)})}function l(e,t,n,r){return e?Object.keys(e).reduce(function(n,i){var a=i;return p.isArray(e[a])?e[a].reduce(function(e,n){return t.call(r,e,n,a)},n):t.call(r,n,e[a],a)},n):n}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./channel"),f=e("./fielddef"),d=e("./log"),p=e("./util");n.channelHasField=r,n.isAggregate=i,n.normalizeEncoding=a,n.isRanged=o,n.fieldDefs=s,n.forEach=u,n.reduce=l},{"./channel":16,"./fielddef":87,"./log":90,"./util":102}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],87:[function(e,t,n){"use strict";function r(e){return e&&!S.isString(e)&&"repeat"in e}function i(e){return!(!e||!e.field&&"count"!==e.aggregate)}function a(e){return e&&"value"in e&&void 0!==e.value}function o(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(l(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=g.binToString(e.bin),i=t.binSuffix):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr&&(n=t.expr+"["+S.stringValue(n)+"]"),n}function s(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return b.isDiscreteByDefault(e.timeUnit)}throw new Error(y.message.invalidFieldType(e.type))}function u(e){return!s(e)}function l(e){return"count"===e.aggregate}function c(e,t){if(l(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function f(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(v.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function d(e,t){if(i(e)){var n=e;if(n.aggregate&&!h.AGGREGATE_OP_INDEX[n.aggregate]){var r=(n.aggregate,m.__rest(n,["aggregate"]));y.warn(y.message.invalidAggregate(n.aggregate)),n=r}if(n.bin){var a=n.bin;S.isBoolean(a)?n=m.__assign({},n,{bin:{maxbins:g.autoMaxBins(t)}}):a.maxbins||a.step||(n=m.__assign({},n,{bin:m.__assign({},a,{maxbins:g.autoMaxBins(t)})}))}if(n.type){var o=_.getFullName(n.type);n.type!==o&&(n=m.__assign({},n,{type:o}))}else{var s=f(n,t);y.warn(y.message.emptyOrInvalidFieldType(n.type,t,s)),n=m.__assign({},n,{type:s})}var u=p(n,t),l=u.compatible,c=u.warning;return l||y.warn(c),n}return e}function p(e,t){switch(t){case"row":case"column":return u(e)&&!e.timeUnit?{compatible:!1,warning:y.message.facetChannelShouldBeDiscrete(t)}:E;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return E;case"opacity":case"size":case"x2":case"y2":return s(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:E;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:E;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:E}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var m=e("tslib"),h=e("./aggregate"),g=e("./bin"),v=e("./channel"),y=e("./log"),b=e("./timeunit"),_=e("./type"),S=e("./util");n.isRepeatRef=r,n.isFieldDef=i,n.isValueDef=a,n.field=o,n.isDiscrete=s,n.isContinuous=u,n.isCount=l,n.title=c,n.defaultType=f,n.normalize=d;var E={compatible:!0};n.channelCompatibility=p},{"./aggregate":13,"./bin":15,"./channel":16,"./log":90,"./timeunit":98,"./type":101,"./util":102,tslib:10}],88:[function(e,t,n){"use strict";function r(e){return e&&e.selection}function i(e){return e&&!!e.field&&void 0!==e.equal}function a(e){return!!(e&&e.field&&p.isArray(e.range)&&2===e.range.length)}function o(e){return e&&!!e.field&&(p.isArray(e.oneOf)||p.isArray(e.in))}function s(e,t){if(p.isString(t))return t;if(r(t)){var n=e.getComponent("selection",t.selection);return l.predicate(t.selection,n.type,n.resolve,null,null)}var s=t.timeUnit?"time("+d.fieldExpr(t.timeUnit,t.field)+")":f.field(t,{expr:"datum"});if(i(t))return s+"==="+u(t.equal,t.timeUnit);if(o(t)){return"indexof(["+(t.oneOf||t.in).map(function(e){return u(e,t.timeUnit)}).join(",")+"], "+s+") !== -1"}if(a(t)){var c=t.range[0],m=t.range[1];if(null!==c&&null!==m)return"inrange("+s+", "+u(c,t.timeUnit)+", "+u(m,t.timeUnit)+")";if(null!==c)return s+" >= "+c;if(null!==m)return s+" <= "+m}}function u(e,t){if(c.isDateTime(e)){var n=c.dateTimeExpr(e,!0);return"time("+n+")"}if(d.isSingleTimeUnit(t)){var r={};r[t]=e;var n=c.dateTimeExpr(r,!0);return"time("+n+")"}return JSON.stringify(e)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./compile/selection/selection"),c=e("./datetime"),f=e("./fielddef"),d=e("./timeunit"),p=e("./util");n.isSelectionFilter=r,n.isEqualFilter=i,n.isRangeFilter=a,n.isOneOfFilter=o,n.expression=s},{"./compile/selection/selection":68,"./datetime":84,"./fielddef":87,"./timeunit":98,"./util":102}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],90:[function(e,t,n){"use strict";function r(e){e(d=new p),o()}function i(e){return function(){var t=d=new p;e(t),o()}}function a(e){return d=e}function o(){return d=f}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.warn.apply(d,arguments)}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.info.apply(d,arguments)}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.debug.apply(d,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("vega-util"),f=c.logger(c.Warn),d=f,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=r,n.wrap=i,n.set=a,n.reset=o,n.warn=s,n.info=u,n.debug=l;!function(e){function t(e){return'Unknown repeated value "'+e+'".'}function n(e){return"Unrecognized parse "+e+"."}function r(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."}function i(e){return'Invalid field type "'+e+'"'}function a(e){return'Invalid aggregation operator "'+e+'"'}function o(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function s(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function u(e,t,n){return e+" dropped as it is incompatible with "+t+(n?" when "+n:"")+"."}function l(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function c(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function f(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function d(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function p(e,t){return"Specified orient "+e+" overridden with "+t}function m(e){return"Cannot use "+e+" with non-color channel."}function h(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function g(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function v(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function y(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function b(e){return"rangeStep for "+e+" is dropped as top-level "+("x"===e?"width":"height")+" is provided."}function _(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function S(e,t){return"FieldDef does not work with "+e+" scale. We are using "+t+" scale instead."}function E(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function x(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function O(e){return"Setting the scale to be independent for "+e+" means we also have to set the guide (axis or legend) to be independent."}function T(e){return"Cannot stack "+e+" if there is already "+e+"2"}function N(e){return"Cannot stack non-linear scale ("+e+")"}function w(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function A(e,t){return"Invalid "+e+": "+t}function D(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}function M(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.noSuchRepeatedValue=t,e.unrecognizedParse=n,e.invalidTransformIgnored=r,e.invalidFieldType=i,e.invalidAggregate=a,e.emptyOrInvalidFieldType=o,e.emptyFieldDef=s,e.incompatibleChannel=u,e.facetChannelShouldBeDiscrete=l,e.discreteChannelCannotEncode=c,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=f,e.unclearOrientDiscreteOrEmpty=d,e.orientOverridden=p,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=m,e.unaggregateDomainHasNoEffectForRawField=h,e.unaggregateDomainWithNonSharedDomainOp=g,e.unaggregatedDomainWithLogScale=v,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=y,e.rangeStepDropped=b,e.scaleTypeNotWorkWithChannel=_,e.scaleTypeNotWorkWithFieldDef=S,e.scalePropertyNotWorkWithScaleType=E,e.scaleTypeNotWorkWithMark=x,e.independentScaleMeansIndependentGuide=O,e.INVAID_DOMAIN="Invalid scale domain",e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=T,e.cannotStackNonLinearScale=N,e.cannotStackNonSummativeAggregate=w,e.invalidTimeUnit=A,e.dayReplacedWithDate=D,e.droppedDay=M}(n.message||(n.message={}))},{"vega-util":106}],91:[function(e,t,n){"use strict";function r(e){return e.type}function i(e){return(r(e)?e.type:e)in s}Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(a=n.Mark||(n.Mark={})),n.AREA=a.AREA,n.BAR=a.BAR,n.LINE=a.LINE,n.POINT=a.POINT,n.TEXT=a.TEXT,n.TICK=a.TICK,n.RECT=a.RECT,n.RULE=a.RULE,n.CIRCLE=a.CIRCLE,n.SQUARE=a.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=r;var s=o.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=i,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={baseline:"middle"},n.defaultTickConfig={thickness:1}},{"./util":102}],92:[function(e,t,n){"use strict";function r(e){var t={};return i.UNIT_SCALE_CHANNELS.forEach(function(n){var r=e[n]||{scale:"shared"},s=o.contains(i.SPATIAL_SCALE_CHANNELS,n)?"axis":"legend";"independent"!==r.scale||"shared"!==r.axis&&"shared"!==r.legend||a.warn(a.message.independentScaleMeansIndependentGuide(n)),t[n]=(u={scale:r.scale||"shared"},u[s]="independent"===r.scale?"independent":r[s]||"shared",u);var u}),t}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./channel"),a=e("./log"),o=e("./util");n.initLayerResolve=r},{"./channel":16,"./log":90,"./util":102}],93:[function(e,t,n){"use strict";function r(e){return e in h}function i(e){return e in g}function a(e){return e in m}function o(e){return e in p}function s(e){return e&&!!e.name}function u(e){return e&&e.selection}function l(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return d.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return o(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return d.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return o(e)||"sequential"===e;case"nice":return o(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return"bin-ordinal"===e||!r(e)&&!d.contains(["log","time","utc","bin-linear"],e)}throw new Error("Invalid scale property "+t+".")}function c(e,t){switch(t){case"range":if("x"===e||"y"===e)return f.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return f.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return f.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return f.message.CANNOT_USE_PADDING_WITH_FACET;return;case"interpolate":case"scheme":if("color"!==e)return f.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".')}Object.defineProperty(n,"__esModule",{value:!0});var f=e("./log"),d=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","bin-linear","log","pow","sqrt","time","utc","sequential","ordinal","bin-ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var p=d.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var m=d.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var h=d.toSet(n.DISCRETE_DOMAIN_SCALES),g=d.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=r,n.isBinScale=i,n.hasContinuousDomain=a,n.isContinuousToContinuous=o,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=s,n.isSelectionDomain=u,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=l,n.channelScalePropertyIncompatability=c},{"./log":90,"./util":102}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultConfig={single:{on:"click",fields:["_id"],resolve:"global"},multi:{on:"click",fields:["_id"],toggle:"event.shiftKey",resolve:"global"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel",resolve:"global"}}},{}],95:[function(e,t,n){"use strict";function r(e){return!!e&&!!e.field&&!!e.op}Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=r},{}],96:[function(e,t,n){"use strict";function r(e){return void 0!==e.facet}function i(e){return!!e.mark}function a(e){return void 0!==e.layer}function o(e){return void 0!==e.repeat}function s(e){return u(e)||l(e)}function u(e){return void 0!==e.vconcat}function l(e){return void 0!==e.hconcat}function c(e,t){if(r(e))return p(e,t);if(a(e))return m(e,t);if(o(e))return h(e,e.config);if(u(e))return g(e,e.config);if(l(e))return v(e,e.config);if(i(e)){var n=M.channelHasField(e.encoding,A.ROW),s=M.channelHasField(e.encoding,A.COLUMN);return n||s?y(e,t):_(e,t)}throw new Error(C.message.INVALID_SPEC)}function f(e,t){return a(e)?m(e,t):o(e)?h(e,t):_(e,t)}function d(e,t){return a(e)?m(e,t):o(e)?h(e,t):_(e,t)}function p(e,t){var n=e.spec,r=w.__rest(e,["spec"]);return w.__assign({},r,{spec:f(n,t)})}function m(e,t){var n=e.layer,r=w.__rest(e,["layer"]);return w.__assign({},r,{layer:n.map(function(e){return a(e)?m(e,t):_(e,t)})})}function h(e,t){var n=e.spec,r=w.__rest(e,["spec"]);return w.__assign({},r,{spec:d(n,t)})}function g(e,t){var n=e.vconcat,r=w.__rest(e,["vconcat"]);return w.__assign({},r,{vconcat:n.map(function(e){return f(e,t)})})}function v(e,t){var n=e.hconcat,r=w.__rest(e,["hconcat"]);return w.__assign({},r,{hconcat:n.map(function(e){return f(e,t)})})}function y(e,t){var n=e.encoding,r=n.row,i=n.column,a=w.__rest(n,["row","column"]),o=e.mark,s=e.selection,u=(e.encoding,w.__rest(e,["mark","selection","encoding"]));return w.__assign({},u,{facet:w.__assign({},r?{row:r}:{},i?{column:i}:{}),spec:_(w.__assign({mark:o,encoding:a},s?{selection:s}:{}),t)})}function b(e){return P.isPrimitiveMark(e.mark)}function _(e,t){if(b(e)){if(M.isRanged(e.encoding))return S(e);var n=t&&t.overlay,r=n&&e.mark===P.AREA&&I.contains(["linepoint","line"],n.area),i=n&&(n.line&&e.mark===P.LINE||"linepoint"===n.area&&e.mark===P.AREA);return i||r?E(e,i,r,t):e}return D.normalize(e,t)}function S(e){var t=M.channelHasField(e.encoding,A.X),n=M.channelHasField(e.encoding,A.Y),r=M.channelHasField(e.encoding,A.X2),i=M.channelHasField(e.encoding,A.Y2);if(r&&!t||i&&!n){var a=I.duplicate(e);return r&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),i&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}function E(e,t,n,r){var i=e.mark,a=e.encoding,o=w.__rest(e,["mark","encoding"]),s=[{mark:i,encoding:a}],u=R.stack(i,a,r?r.stack:void 0),l=a;if(u){var c=u.fieldChannel,f=u.offset;l=w.__assign({},a,(d={},d[c]=w.__assign({},a[c],f?{stack:f}:{}),d))}return n&&s.push({mark:{type:"line",role:"lineOverlay"},encoding:l}),t&&s.push({mark:{type:"point",filled:!0,role:"pointOverlay"},encoding:l}),w.__assign({},o,{layer:s});var d}function x(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),r=I.hash(n);e[r]=e[r]||t}),e}function O(e,t){if(void 0===t&&(t={}),a(e))e.layer.forEach(function(e){i(e)?x(t,k.fieldDefs(e.encoding)):O(e,t)});else if(r(e))x(t,k.fieldDefs(e.facet)),O(e.spec,t);else if(o(e))x(t,k.fieldDefs(e.spec)),O(e.spec,t);else if(s(e)){var n=u(e)?e.vconcat:e.hconcat;n.forEach(function(e){i(e)?x(t,k.fieldDefs(e.encoding)):O(e,t)})}else x(t,k.fieldDefs(e.encoding));return t}function T(e){return I.vals(O(e))}function N(e,t){return t=t||e.config,!!P.isPrimitiveMark(e.mark)&&null!==R.stack(e.mark,e.encoding,t?t.stack:void 0)}Object.defineProperty(n,"__esModule",{value:!0});var w=e("tslib"),A=e("./channel"),D=e("./compositemark"),M=e("./encoding"),k=e("./encoding"),C=e("./log"),P=e("./mark"),R=e("./stack"),I=e("./util");n.isFacetSpec=r,n.isUnitSpec=i,n.isLayerSpec=a,n.isRepeatSpec=o,n.isConcatSpec=s,n.isVConcatSpec=u,n.isHConcatSpec=l,n.normalize=c,n.fieldDefs=T,n.isStacked=N},{"./channel":16,"./compositemark":81,"./encoding":85,"./log":90,"./mark":91,"./stack":97,"./util":102,tslib:10}],97:[function(e,t,n){"use strict";function r(e,t,r){var d=l.isMarkDef(e)?e.type:e;if(!f.contains(n.STACKABLE_MARKS,d))return null;if(!s.isAggregate(t))return null;var p=o.STACK_GROUP_CHANNELS.reduce(function(e,n){if(s.channelHasField(t,n)){var r=t[n];(f.isArray(r)?r:[r]).forEach(function(t){u.isFieldDef(t)&&!t.aggregate&&e.push({channel:n,fieldDef:t})})}return e},[]);if(0===p.length)return null;var m=u.isFieldDef(t.x),h=u.isFieldDef(t.y),g=u.isFieldDef(t.x)&&!!t.x.aggregate;if(g!==(u.isFieldDef(t.y)&&!!t.y.aggregate)){
var v=g?o.X:o.Y,y=t[v],b=y.aggregate,_=y.scale,S=null;return S=void 0!==y.stack?y.stack:f.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===r?"zero":r,S&&"none"!==S?_&&_.type&&_.type!==c.ScaleType.LINEAR?(i.warn(i.message.cannotStackNonLinearScale(_.type)),null):s.channelHasField(t,v===o.X?o.X2:o.Y2)?(i.warn(i.message.cannotStackRangedMark(v)),null):f.contains(a.SUM_OPS,b)?{groupbyChannel:g?h?o.Y:null:m?o.X:null,fieldChannel:v,stackBy:p,offset:S}:(i.warn(i.message.cannotStackNonSummativeAggregate(b)),null):null}return null}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./log"),a=e("./aggregate"),o=e("./channel"),s=e("./encoding"),u=e("./fielddef"),l=e("./mark"),c=e("./scale"),f=e("./util");n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=r},{"./aggregate":13,"./channel":16,"./encoding":85,"./fielddef":87,"./log":90,"./mark":91,"./scale":93,"./util":102}],98:[function(e,t,n){"use strict";function r(e){return!!h[e]}function i(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case f.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case f.YEAR:r.setFullYear(t.getFullYear());break;case f.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case f.MONTH:r.setMonth(t.getMonth());break;case f.DATE:r.setDate(t.getDate());break;case f.HOURS:r.setHours(t.getHours());break;case f.MINUTES:r.setMinutes(t.getMinutes());break;case f.SECONDS:r.setSeconds(t.getSeconds());break;case f.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function a(e){return!!g[e]}function o(e,t){var n=e.indexOf(t);return n>-1&&(t!==f.SECONDS||0===n||"i"!==e.charAt(n-1))}function s(e,t){function r(e){return e===f.QUARTER?"(quarter("+i+")-1)":e+"("+i+")"}var i="datum["+m.stringValue(t)+"]",a=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=r(n)),t},{});return a.day&&m.keys(a).length>1&&(p.warn(p.message.dayReplacedWithDate(e)),delete a.day,a.date=r(f.DATE)),d.dateTimeExpr(a)}function u(e){if(e)return o(e,f.SECONDS)?"second":o(e,f.MINUTES)?"minute":o(e,f.HOURS)?"hour":o(e,f.DAY)||o(e,f.DATE)?"day":o(e,f.MONTH)?"month":o(e,f.YEAR)?"year":void 0}function l(e,t,n){if(e){var r=[],i="",a=o(e,f.YEAR);o(e,f.QUARTER)&&(i="'Q' + quarter("+t+")"),o(e,f.MONTH)&&r.push(!1!==n?"%b":"%B"),o(e,f.DAY)?r.push(n?"%a":"%A"):o(e,f.DATE)&&r.push("%d"+(a?",":"")),a&&r.push(n?"%y":"%Y");var s=[];o(e,f.HOURS)&&s.push("%H"),o(e,f.MINUTES)&&s.push("%M"),o(e,f.SECONDS)&&s.push("%S"),o(e,f.MILLISECONDS)&&s.push("%L");var u=[];return r.length>0&&u.push(r.join(" ")),s.length>0&&u.push(s.join(":")),u.length>0&&(i&&(i+=" + ' ' + "),i+="timeFormat("+t+", '"+u.join(" ")+"')"),i||void 0}}function c(e){switch(e){case"hours":case"day":case"month":case"quarter":return!0}return!1}Object.defineProperty(n,"__esModule",{value:!0});var f,d=e("./datetime"),p=e("./log"),m=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(f=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[f.YEAR,f.QUARTER,f.MONTH,f.DAY,f.DATE,f.HOURS,f.MINUTES,f.SECONDS,f.MILLISECONDS];var h=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=i,n.MULTI_TIMEUNITS=[f.YEARQUARTER,f.YEARQUARTERMONTH,f.YEARMONTH,f.YEARMONTHDATE,f.YEARMONTHDATEHOURS,f.YEARMONTHDATEHOURSMINUTES,f.YEARMONTHDATEHOURSMINUTESSECONDS,f.QUARTERMONTH,f.HOURSMINUTES,f.HOURSMINUTESSECONDS,f.MINUTESSECONDS,f.SECONDSMILLISECONDS];var g=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=a,n.TIMEUNITS=[f.YEAR,f.QUARTER,f.MONTH,f.DAY,f.DATE,f.HOURS,f.MINUTES,f.SECONDS,f.MILLISECONDS,f.YEARQUARTER,f.YEARQUARTERMONTH,f.YEARMONTH,f.YEARMONTHDATE,f.YEARMONTHDATEHOURS,f.YEARMONTHDATEHOURSMINUTES,f.YEARMONTHDATEHOURSMINUTESSECONDS,f.QUARTERMONTH,f.HOURSMINUTES,f.HOURSMINUTESSECONDS,f.MINUTESSECONDS,f.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=s,n.smallestUnit=u,n.formatExpression=l,n.isDiscreteByDefault=c},{"./datetime":84,"./log":90,"./util":102}],99:[function(e,t,n){"use strict";function r(e){return i.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}Object.defineProperty(n,"__esModule",{value:!0});var i=["background","padding"];n.extractTopLevelProperties=r},{}],100:[function(e,t,n){"use strict";function r(e){return void 0!==e.filter}function i(e){return void 0!==e.calculate}Object.defineProperty(n,"__esModule",{value:!0}),n.isFilter=r,n.isCalculate=i},{}],101:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={})),n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=r},{}],102:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=b(e);return t.forEach(function(e){delete n[e]}),n}function a(e){return O.isString(e)||O.isNumber(e)||_(e)?String(e):E(e)}function o(e,t){return e.indexOf(t)>-1}function s(e,t){return e.filter(function(e){return!o(t,e)})}function u(e,t){return e.concat(s(t,e))}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function c(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function f(e){return[].concat.apply([],e)}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=p(e,i[r])}return e}function p(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||O.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=d(t[n].constructor===Array?[]:{},t[n]):d(e[n],t[n]));return e}function m(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var s=o[a];n=t(s),n in i||(i[n]=1,r.push(s))}return r}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function g(e,t){for(var n in e)if(n in t)return!0;return!1}function v(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function y(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function b(e){return JSON.parse(JSON.stringify(e))}function _(e){return!0===e||!1===e}function S(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}Object.defineProperty(n,"__esModule",{value:!0});var E=e("json-stable-stringify"),x=e("vega-util");n.extend=x.extend,n.isArray=x.isArray,n.isObject=x.isObject,n.isNumber=x.isNumber,n.isString=x.isString,n.truncate=x.truncate,n.toSet=x.toSet,n.stringValue=x.stringValue;var O=e("vega-util");n.pick=r,n.omit=i,n.hash=a,n.contains=o,n.without=s,n.union=u,n.some=l,n.every=c,n.flatten=f,n.mergeDeep=d,n.unique=m,n.differ=h,n.hasIntersection=g,n.differArray=v,n.keys=Object.keys,n.vals=y,n.duplicate=b,n.isBoolean=_,n.varName=S},{"json-stable-stringify":6,"vega-util":106}],103:[function(e,t,n){"use strict";function r(e,t,r){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===r&&(r=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var o=i.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,u=t[o],l=r[o];for(var c in u)if(!(u[c]in s))return'Missing encoding channel "'+u[c]+'" for mark "'+o+'"';for(var f in s)if(!l[f])return'Encoding channel "'+f+'" is not supported by mark type "'+o+'"';return o!==a.BAR||s.x||s.y?null:"Missing both x and y for bar"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mark"),a=e("./mark"),o=e("./util");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:o.toSet(["row","column","x","y","size","color","detail"]),line:o.toSet(["row","column","x","y","color","detail"]),area:o.toSet(["row","column","x","y","color","detail"]),tick:o.toSet(["row","column","x","y","color","detail"]),circle:o.toSet(["row","column","x","y","color","size","detail"]),square:o.toSet(["row","column","x","y","color","size","detail"]),point:o.toSet(["row","column","x","y","color","size","detail","shape"]),text:o.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=r},{"./mark":91,"./util":102}],104:[function(e,t,n){"use strict";function r(e){return!s.isArray(e)&&("fields"in e&&!("data"in e))}function i(e){return!s.isArray(e)&&("fields"in e&&"data"in e)}function a(e){return!s.isArray(e)&&("field"in e&&"data"in e)}function o(e){return!s.isArray(e)&&"signal"in e}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./util");n.isDataRefUnionedDomain=r,n.isFieldRefUnionDomain=i,n.isDataRefDomain=a,n.isSignalRefDomain=o},{"./util":102}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var r=e("./compile/compile");n.compile=r.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":12,"./aggregate":13,"./axis":14,"./bin":15,"./channel":16,"./compile/compile":21,"./compositemark":81,"./config":82,"./data":83,"./datetime":84,"./encoding":85,"./facet":86,"./fielddef":87,"./legend":89,"./mark":91,"./scale":93,"./sort":95,"./spec":96,"./stack":97,"./timeunit":98,"./transform":100,"./type":101,"./util":102,"./validate":103}],106:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return u(e)?"["+e.map(r)+"]":l(e)||c(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},s=function(e){function t(){a.push(c+e.substring(n,r)),c="",n=r+1}var n,r,i,a=[],s=null,u=0,l=e.length,c="";for(e+="",n=r=0;r<l;++r)if("\\"===(i=e[r]))c+=e.substring(n,r),n=++r;else if(i===s)t(),s=null,u=-1;else{if(s)continue;n===u&&'"'===i?(n=r+1,s=i):n===u&&"'"===i?(n=r+1,s=i):"."!==i||u?"["===i?(r>n&&t(),u=n=r+1):"]"===i&&(u||o("Access path missing open bracket: "+e),u>0&&t(),u=0,n=r+1):r>n?t():n=r+1}return u&&o("Access path missing closing bracket: "+e),s&&o("Access path missing closing quote: "+e),r>n&&(++r,t()),a},u=Array.isArray,l=function(e){return e===Object(e)},c=function(e){return"string"==typeof e},f=function(e,t){var n=s(e),i="return _["+n.map(r).join("][")+"];";return a(Function("_",i),[e=1===n.length?n[0]:e],t||e)},d=[],p=f("id"),m=a(function(e){return e},d,"identity"),h=a(function(){return 0},d,"zero"),g=a(function(){return 1},d,"one"),v=a(function(){return!0},d,"true"),y=a(function(){return!1},d,"false"),b=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=1&&i("warn","WARN",arguments),this},info:function(){return t>=2&&i("log","INFO",arguments),this},debug:function(){return t>=3&&i("log","DEBUG",arguments),this}}},_=function(e){return null!=e?u(e)?e:[e]:[]},S=function(e,t){var n,i,o,u,l,c,f,d,p=[],m=(e=_(e)).map(function(e,t){return null==e?null:(p.push(t),s(e).map(r).join("]["))}),h=p.length-1,g=_(t),v="var u,v;return ";if(h<0)return null;for(i=0;i<=h;++i)n=p[i],o=m[n],u="(u=a["+o+"])",l="(v=b["+o+"])",c="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",f="descending"!==g[n]?(d=1,-1):(d=-1,1),v+="("+u+"<"+l+"||u==null)&&v!=null?"+f+":(u>v||v==null)&&u!=null?"+d+":"+c+"!==u&&v===v?"+f+":v!==v&&u===u?"+d+(n<h?":":":0");return a(Function("a","b",v+";"),e.filter(function(e){return null!=e}))},E=function(e){return"function"==typeof e},x=function(e){return E(e)?e:function(){return e}},O=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},T=function(e,t){var n,r,i,a,o,s=-1,u=e.length;if(null==t){for(;++s<u;)if(null!=(r=e[s])&&r>=r){n=i=r;break}for(a=o=s;++s<u;)null!=(r=e[s])&&(n>r&&(n=r,a=s),i<r&&(i=r,o=s))}else{for(;++s<u;)if(null!=(r=t(e[s],s,e))&&r>=r){n=i=r;break}for(a=o=s;++s<u;)null!=(r=t(e[s],s,e))&&(n>r&&(n=r,a=s),i<r&&(i=r,o=s))}return[a,o]},N={},w=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==N}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===N&&--n.empty),i[e]=r,this},delete:function(e){return t(e)&&(--n.size,++n.empty,i[e]=N),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,a={},o=0;for(e in i)(t=i[e])===N||r&&r(t)||(a[e]=t,++o);n.size=o,n.empty=0,n.object=i=a}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},A=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},D=function(e){return"boolean"==typeof e},M=function(e){return"[object Date]"===Object.prototype.toString.call(e)},k=function(e){return"number"==typeof e},C=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},P=function(e){e=e?_(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+s(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},R=function(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),s=0,u=0,l=0;s<i&&u<a;++l)o[l]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<i;++s,++l)o[l]=t[s];for(;u<a;++u,++l)o[l]=n[u];return o},I=function(e,t){for(var n="";--t>=0;)n+=e;return n},L=function(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?I(i,o)+a:"center"===r?I(i,~~(o/2))+a+I(i,Math.ceil(o/2)):a+I(i,o)},U=function(e){return e[e.length-1]},F=function(e){return null==e||""===e?null:!(!e||"false"===e)&&!!e},j=function(e,t){return null==e||""===e?null:t?t(e):Date.parse(e)},H=function(e){return null==e||""===e?null:+e},z=function(e){return null==e||""===e?null:e+""},Y=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},X=function(e,t,n,r){var i=null!=r?r:"â¦",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i},W=function(e,t,n){if(e){var r,i=0,a=e.length;if(t)for(;i<a;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=a,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=m,e.zero=h,e.one=g,e.truthy=v,e.falsy=y,e.logger=b,e.None=0,e.Warn=1,e.Info=2,e.Debug=3,e.array=_,e.compare=S,e.constant=x,e.error=o,e.extend=O,e.extentIndex=T,e.fastmap=w,e.field=f,e.inherits=A,e.isArray=u,e.isBoolean=D,e.isDate=M,e.isFunction=E,e.isNumber=k,e.isObject=l,e.isRegExp=C,e.isString=c,e.key=P,e.merge=R,e.pad=L,e.peek=U,e.repeat=I,e.splitAccessPath=s,e.stringValue=r,e.toBoolean=F,e.toDate=j,e.toNumber=H,e.toString=z,e.toSet=Y,e.truncate=X,e.visitArray=W,Object.defineProperty(e,"__esModule",{value:!0})})},{}],107:[function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t={showAllFields:!0}),e.addEventListener("mouseover.tooltipInit",function(e,n){p(n)&&(a(),z=window.setTimeout(function(){c(e,n,t)},t.delay||H))}),e.addEventListener("mousemove.tooltipUpdate",function(e,n){p(n)&&Y&&f(e,n,t)}),e.addEventListener("mouseout.tooltipRemove",function(e,n){p(n)&&(a(),Y&&d(e,n,t))}),{destroy:function(){e.removeEventListener("mouseover.tooltipInit"),e.removeEventListener("mousemove.tooltipUpdate"),e.removeEventListener("mouseout.tooltipRemove"),a()}}}function i(e,t,n){return void 0===n&&(n={}),n=o(n,t),e.addEventListener("mouseover.tooltipInit",function(e,t){p(t)&&(a(),z=window.setTimeout(function(){c(e,t,n)},n.delay||H))}),e.addEventListener("mousemove.tooltipUpdate",function(e,t){p(t)&&Y&&f(e,t,n)}),e.addEventListener("mouseout.tooltipRemove",function(e,t){p(t)&&(a(),Y&&d(e,t,n))}),{destroy:function(){e.removeEventListener("mouseover.tooltipInit"),e.removeEventListener("mousemove.tooltipUpdate"),e.removeEventListener("mouseout.tooltipRemove"),a()}}}function a(){window.clearTimeout(z),z=void 0}function o(e,t){var n=[];return!1!==e.showAllFields?j.spec.fieldDefs(t).forEach(function(r){var i=s(e.fields,r),a=l(i,r,t);n.push(a)}):e.fields&&e.fields.forEach(function(e){var r=u(j.spec.fieldDefs(t),e),i=l(e,r,t);n.push(i)}),e.fields=n,e}function s(e,t){if(t&&e&&!(e.length<=0))if(t.aggregate){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.field===t.field&&i.aggregate===t.aggregate)return i}for(var a=0,o=e;a<o.length;a++){var i=o[a];if(i.field===t.field&&!i.aggregate)return i}}else for(var s=0,u=e;s<u.length;s++){var i=u[s];if(i.field===t.field)return i}}function u(e,t){if(t&&t.field&&e)for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.field===t.field){if(!i.aggregate)return i;if(i.aggregate===t.aggregate||!t.aggregate)return i}}}function l(e,t,n){var r=j.util.extend({},n.config);if(!e&&!t)return void console.error("[Tooltip] Cannot supplement a field when field and fieldDef are both empty.");!e&&t&&(e={}),e&&!t&&(t={});var i={};if(i.field=t.field?j.fieldDef.field(t):e.field,t.type===F.TEMPORAL&&t.timeUnit){var a=t.field;i.removeOriginalTemporalField=a;for(var o=j.spec.fieldDefs(n),s=0,u=o;s<u.length;s++){var l=u[s];if(l.field===a&&!l.timeUnit){i.removeOriginalTemporalField=void 0;break}}}if(r.countTitle||(r.countTitle=j.config.defaultConfig.countTitle),i.title=e.title?e.title:j.fieldDef.title(t,r),i.formatType=e.formatType?e.formatType:X[t.type],e.format)i.format=e.format;else switch(i.formatType){case"time":i.format=t.timeUnit?j.timeUnit.formatExpression(t.timeUnit,"",!1).split("'")[1]:r.timeFormat||j.config.defaultConfig.timeFormat;break;case"number":i.format=r.numberFormat}return t.bin&&(i.field=i.field.replace("_start","_range"),i.bin=!0,i.formatType="string"),i}function c(e,t,n){var r=N(),i=m(t,n);i&&0!==i.length&&(w(r,i),D(e,n),k(n),I.select("#vis-tooltip").style("visibility","visible"),Y=!0,n.onAppear&&n.onAppear(e,t))}function f(e,t,n){D(e,n),n.onMove&&n.onMove(e,t)}function d(e,t,n){I.select("#vis-tooltip").style("visibility","hidden"),Y=!1,A(),C(),M(),n.onDisappear&&n.onDisappear(e,t)}function p(e){return!(!e||!e.datum)&&(!e.datum._facetID&&!!e.datum._id)}function m(e,t){if("group"!==e.mark.marktype||"nested_main_group"!==e.mark.name){var n=P.map(e.datum);return y(n,["_id","_prev","width","height","count_start","count_end","layout_start","layout_mid","layout_end","layout_path","layout_x","layout_y"]),b(n,t.fields),_(n,t.fields),S(e.mark.marktype,n),!0===t.showAllFields?v(n,t):h(n,t)}}function h(e,t){var n=[];return t.fields.forEach(function(t){var r=t.title?t.title:t.field,i=g(e,t.field);if(void 0!==i){var a=E(i,t.formatType,t.format)||x(i);n.push({title:r,value:a})}}),n}function g(e,t){var n,r=t.split("."),i=r[0];return r.shift(),e.has(i)&&(n=e.get(i),r.forEach(function(e){n[e]&&(n=n[e])})),void 0===n?void console.warn("[Tooltip] Cannot find field "+t+" in data."):n}function v(e,t){var n=[],r=P.map(t.fields,function(e){return e.field});return e.each(function(e,t){var i;i=r.has(t)&&r.get(t).title?r.get(t).title:t;var a,o;r.has(t)&&(a=r.get(t).formatType,o=r.get(t).format);var s=E(e,a,o)||x(e);n.push({title:i,value:s})}),n}function y(e,t){t.forEach(function(t){e.remove(t)})}function b(e,t){t&&t.forEach(function(t){t.removeOriginalTemporalField&&y(e,[t.removeOriginalTemporalField])})}function _(e,t){if(t)return t.forEach(function(t){if(!0===t.bin){var n=t.field,r=n.concat("_start"),i=n.concat("_mid"),a=n.concat("_end"),o=e.get(r),s=e.get(a);if(void 0!==o&&void 0!==s){var u=o+"-"+s;e.set(n,u)}var l=[];l.push(r,i,a),y(e,l)}}),e}function S(e,t){if("line"===e||"area"===e){var n=[];t.each(function(e,t){e instanceof Date&&n.push(t)}),y(t,n)}}function E(e,t,n){if(void 0!==e&&null!==e&&t)switch(t){case"time":return n?U.timeFormat(n)(e):T(e);case"number":return n?R.format(n)(e):O(e);case"string":default:return e}}function x(e){return"number"==typeof e?O(e):e instanceof Date?T(e):e}function O(e){return e%1==0?R.format(",")(e):R.format(",.2f")(e)}function T(e){var t=U.timeFormat(".%L"),n=U.timeFormat(":%S"),r=U.timeFormat("%I:%M"),i=U.timeFormat("%I %p"),a=U.timeFormat("%a %d"),o=U.timeFormat("%b %d"),s=U.timeFormat("%B"),u=U.timeFormat("%Y");return(L.timeSecond(e)<e?t:L.timeMinute(e)<e?n:L.timeHour(e)<e?r:L.timeDay(e)<e?i:L.timeMonth(e)<e?L.timeWeek(e)<e?a:o:L.timeYear(e)<e?s:u)(e)}function N(){return I.select("#vis-tooltip").empty()?I.select("body").append("div").attr("id","vis-tooltip").attr("class","vg-tooltip"):I.select("#vis-tooltip")}function w(e,t){e.selectAll("table").remove();var n=e.append("table").selectAll(".tooltip-row").data(t);n.exit().remove();var r=n.enter().append("tr").attr("class","tooltip-row");r.append("td").attr("class","key").text(function(e){return e.title+":"}),r.append("td").attr("class","value").text(function(e){return e.value})}function A(){I.select("#vis-tooltip").selectAll(".tooltip-row").data([]).exit().remove()}function D(e,t){var n=10,r=10;t&&t.offset&&void 0!==t.offset.x&&null!==t.offset.x&&(n=t.offset.x),t&&t.offset&&void 0!==t.offset.y&&null!==t.offset.y&&(r=t.offset.y),I.select("#vis-tooltip").style("top",function(){var t=this.getBoundingClientRect().height;return e.clientY+t+r<window.innerHeight?e.clientY+r+"px":e.clientY-t-r+"px"}).style("left",function(){var t=this.getBoundingClientRect().width;return e.clientX+t+n<window.innerWidth?e.clientX+n+"px":e.clientX-t-n+"px"})}function M(){I.select("#vis-tooltip").style("top","-9999px").style("left","-9999px")}function k(e){C(),e&&"dark"===e.colorTheme?I.select("#vis-tooltip").classed("dark-theme",!0):I.select("#vis-tooltip").classed("light-theme",!0)}function C(){I.select("#vis-tooltip").classed("dark-theme light-theme",!1)}Object.defineProperty(n,"__esModule",{value:!0});var P=e("d3-collection"),R=e("d3-format"),I=e("d3-selection"),L=e("d3-time"),U=e("d3-time-format"),F=e("vega-lite/build/src/type"),j=e("vega-lite/build/src/vl"),H=100,z=void 0,Y=!1;n.vega=r,n.vegaLite=i;var X={quantitative:"number",temporal:"time",ordinal:void 0,nominal:void 0}},{"d3-collection":1,"d3-format":2,"d3-selection":3,"d3-time":5,"d3-time-format":4,"vega-lite/build/src/type":101,"vega-lite/build/src/vl":105}]},{},[107])(107)});
